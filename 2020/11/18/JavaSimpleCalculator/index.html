<!DOCTYPE html>

<html lang="zh-CN">

<head>
  
  <title>Java Simple Calculator - ShiJh-Blog</title>
  <meta charset="UTF-8">
  <meta name="description" content="欢迎来到我的博客">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png" />
  <meta name="description" content="swing ui 编写、功能简单且存在一点瑕疵的计算器程序">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Simple Calculator">
<meta property="og:url" content="https://blog.pressed.top/2020/11/18/JavaSimpleCalculator/">
<meta property="og:site_name" content="ShiJh-Blog">
<meta property="og:description" content="swing ui 编写、功能简单且存在一点瑕疵的计算器程序">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-17T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-13T04:38:20.043Z">
<meta property="article:author" content="ShiJh">
<meta property="article:tag" content="java swing">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/theme-nexmoe/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,gh/theme-nexmoe/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css?v=233" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1615614996172">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="ShiJh" class="mdui-btn mdui-btn-icon"><img src="https://raw.githubusercontent.com/838239178/838239178.github.io/main/assets/images/myIcon.jpg" alt="ShiJh"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="ShiJh">
            <img src="https://raw.githubusercontent.com/838239178/838239178.github.io/main/assets/images/myIcon.jpg" alt="ShiJh" alt="ShiJh">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>9</div>
        <div><span>标签</span>5</div>
        <div><span>分类</span>0</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/20238211" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/nexmoe/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  

  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/algorithm-c-c/" style="font-size: 15px;">algorithm c/c++</a> <a href="/tags/cocos-tiledmap/" style="font-size: 10px;">cocos tiledmap</a> <a href="/tags/java-swing/" style="font-size: 15px;">java swing</a> <a href="/tags/java-web/" style="font-size: 20px;">java web</a> <a href="/tags/web-ai/" style="font-size: 10px;">web ai</a>
    </div>
    
  </div>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 ShiJh
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
  
      <div class="nexmoe-post-cover" style="padding-bottom: NaN%;"> 
          <img data-src="/assets/images/crazy.png" data-sizes="auto" alt="Java Simple Calculator" class="lazyload">
          <h1>Java Simple Calculator</h1>
      </div>
  
  
  <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年11月18日</a>
    <a><i class="nexmoefont icon-areachart"></i>1.7k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 8 分钟</a>
</div>

  <div class="nexmoe-post-right">
    
  </div>

  <article>
    <p>123</p>
<span id="more"></span>


<h1 id="简易计算器"><a href="#简易计算器" class="headerlink" title="简易计算器"></a>简易计算器</h1><h2 id="程序解释"><a href="#程序解释" class="headerlink" title="程序解释"></a>程序解释</h2><h3 id="原理详解"><a href="#原理详解" class="headerlink" title="原理详解"></a>原理详解</h3><p>从类的设计的角度上来讲，计算器应该是界面与操作分离，由界面程序获取操作数并传递给计算程序，从计算程序中获取结果。</p>
<h3 id="类的设计"><a href="#类的设计" class="headerlink" title="类的设计"></a>类的设计</h3><ol>
<li><p>Calculator</p>
<p>用于计算的类，传入操作数和操作符后可获取结果，运算错误抛出异常。</p>
</li>
<li><p>Calculator Frame</p>
<p>计算器的界面类，提供操作数和操作符。</p>
</li>
</ol>
<h2 id="结构解析"><a href="#结构解析" class="headerlink" title="结构解析"></a>结构解析</h2><p>Calculator类采用两个堆栈分别存放运算数和操作符，在计算时从中抛出操作数与操作符。对小数和负数，采用标记位进行判断。</p>
<p>小数：当输入了小数点“.“后，记录接下来输入数字的个数，在数字输入结束后（即输入操作符）时，将栈中的第一位数抛出并转化为小数</p>
<p>负数：当输入了”neg”标记后，同上，在同一时刻转化成负数</p>
<p>输入数字或者操作符后，自动检查堆栈元素进行计算，因此这个简易计算器在按下“=”前，在特定情况下，会先计算部分算式；</p>
<p><del><em>另一种思路：输入的任何符号都先记录起来等按下“=”时再进行读取数字和操作符进行运算</em></del></p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>因为即时运算的原因，计算器无法实现单步删除功能，只能直接清空重置计算器。代码可拓展性差，添加新的操作符运算可能需要改动部分原有逻辑。</p>
<p><del>要不要改？卧槽，我懒啊！</del></p>
<h3 id="源码展示"><a href="#源码展示" class="headerlink" title="源码展示"></a>源码展示</h3><h6 id="Calculator-java"><a href="#Calculator-java" class="headerlink" title="Calculator.java"></a>Calculator.java</h6><pre><code class="java">package calculator;

import com.sun.xml.internal.ws.api.ha.StickyFeature;

import java.math.BigDecimal;
import java.util.Arrays;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;

public class Calculator &#123;
    private final HashMap&lt;String, Integer&gt; operatorPriority;

    private final LinkedList&lt;Double&gt; numberStack;
    private final LinkedList&lt;String&gt; operatorStack;

    /**
     * 是否开始输入下一个数字
     */
    private boolean nextNum;
    /**
     * 是否已经完成了一次计算
     */
    private boolean calculated;
    /**
     * 是否输入了小数
     */
    private boolean decimal;
    private int decimalDigits;
    /**
     * 是否输入了负数
     */
    private boolean negative;

    public Calculator() &#123;
        operatorPriority = new HashMap&lt;&gt;();
        numberStack = new LinkedList&lt;&gt;();
        operatorStack = new LinkedList&lt;&gt;();

        List&lt;String&gt; level1 = Arrays.asList(&quot;+&quot;, &quot;-&quot;);
        List&lt;String&gt; level2 = Arrays.asList(&quot;*&quot;, &quot;/&quot;, &quot;%&quot;);
        level1.forEach(op -&gt; operatorPriority.put(op, 1));
        level2.forEach(op -&gt; operatorPriority.put(op, 2));


        reset();
    &#125;

    public void reset() &#123;
        calculated = true;
        numberStack.clear();
        operatorStack.clear();
        numberStack.push(0.0);
        nextNum = true;
        negative = false;
        decimal = false;
        decimalDigits = 0;
    &#125;

    /**
     * 是否已经完成了一次计算
     */
    public boolean isCalculated() &#123;
        return this.calculated;
    &#125;

    /**
     * 获得计算结果
     *
     * @return 计算结果
     * @throws ArithmeticException 如果输入不合法运算公式则抛出这个异常
     */
    public double getResult() throws ArithmeticException &#123;
        tryDecimal();
        tryNegative();

        while (!numberStack.isEmpty() &amp;&amp; !operatorStack.isEmpty()) &#123;
            double num2 = numberStack.pop();
            double num1 = numberStack.pop();
            String operator = operatorStack.pop();
            numberStack.push(calculate(num1, num2, operator));
        &#125;

        calculated = true;

        if (numberStack.isEmpty()) &#123;
            return 0.0;
        &#125; else &#123;
            return numberStack.peek();
        &#125;
    &#125;

    /**
     * 输入一个操作数
     *
     * @param value 整数
     */
    public void inputNum(int value) &#123;
        double number = value;
        if (!nextNum) &#123;
            number = numberStack.pop();
            number = number * 10 + value;
            if (decimal) decimalDigits++;
        &#125;
        numberStack.push(number);

        //开始输入当前这个数字
        nextNum = false;
        //还未完成一次计算
        calculated = false;
    &#125;

    /**
     * 输入一个运算符号
     *
     * @param op 运算符号，目前仅支持“+、-、*、/“，支持小数和负数
     * @throws ArithmeticException 如果输入不合法运算公式则抛出这个异常
     */
    public void inputOperator(String op) throws ArithmeticException &#123;
        //输入运算符时意味着正在进行运算（即未完成）
        calculated = false;

        if (op.equals(&quot;.&quot;)) &#123;
            decimal = true;
            return;
        &#125;

        if(op.equals(&quot;neg&quot;))&#123;
            negative = !negative;
            return;
        &#125;

        tryDecimal();
        tryNegative();

        while (!operatorStack.isEmpty() &amp;&amp; compareOperator(op, operatorStack.peek()) &lt; 0) &#123;
            Double num2 = numberStack.pop();
            Double num1 = numberStack.pop();
            String operator = operatorStack.pop();
            numberStack.push(calculate(num1, num2, operator));
        &#125;

        operatorStack.push(op);

        //输运算符后意味着开始输入下一个数字
        nextNum = true;
    &#125;

    /**
     * 检验是否输入了小数
     */
    private boolean tryDecimal() &#123;
        //如果刚刚输入的数字（即栈顶）是小数
        if (decimal) &#123;
            double top = numberStack.pop();
            top *= Math.pow(10, -1 * decimalDigits);
            numberStack.push(top);

            //下一个数字不一定是小数，重置小数参数
            decimal = false;
            decimalDigits = 0;

            return true;
        &#125;
        return false;
    &#125;

    private boolean tryNegative() &#123;
        if(negative)&#123;
            double top = numberStack.pop();
            numberStack.push(-top);

            //重置标记
            negative = false;

            return true;
        &#125;
        return false;
    &#125;

    private double calculate(double num1, double num2, String op) &#123;
        //使用string类型消除double精度误差
        BigDecimal bigNum1 = new BigDecimal(String.valueOf(num1));
        BigDecimal bigNum2 = new BigDecimal(String.valueOf(num2));
        BigDecimal result;
        switch (op) &#123;
            case &quot;+&quot;:
                result = bigNum1.add(bigNum2);
                break;
            case &quot;-&quot;:
                result = bigNum1.subtract(bigNum2);
                break;
            case &quot;*&quot;:
                result = bigNum1.multiply(bigNum2);
                break;
            case &quot;/&quot;:
                result = bigNum1.divide(bigNum2, BigDecimal.ROUND_HALF_UP);
                break;
            default:
                throw new ArithmeticException();
        &#125;

        return result.doubleValue();
    &#125;

    private int compareOperator(String op1, String op2) &#123;
        int op1Level = 0, op2Level = 0;

        op1Level = operatorPriority.get(op1);
        op2Level = operatorPriority.get(op2);

        return op1Level - op2Level;
    &#125;

&#125;
</code></pre>
<h6 id="CalculatorFrame-java"><a href="#CalculatorFrame-java" class="headerlink" title="CalculatorFrame.java"></a>CalculatorFrame.java</h6><pre><code class="java">package calculator;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class CalculatorFrame extends JFrame &#123;
    //region -JComponents-
    private JPanel northPanel;
    private JPanel centerPanel;
    private JPanel numberPanel;
    private JPanel operatorPanel;
    private JPanel southPanel;
    private JPanel westPanel;
    private JPanel eastPanel;
    private JTextField textArea;
    private JButton[] numberBtn;
    private JButton[] operatorBtn;
    private JButton point;
    private JButton delete;
    private JButton neg;
    //endregion

    private Calculator calculator;

    private void initComponent() &#123;
        this.setLayout(new BorderLayout(10, 10));

        centerPanel = new JPanel(new BorderLayout(10, 6));
        numberPanel = new JPanel(new GridLayout(4, 4, 10, 10));
        operatorPanel = new JPanel(new GridLayout(6, 1, 10, 6));

        northPanel = new JPanel();
        southPanel = new JPanel();
        eastPanel = new JPanel();
        westPanel = new JPanel();

        textArea = new JTextField(&quot;0&quot;, 1);

        numberBtn = new JButton[10];
        operatorBtn = new JButton[5];
        delete = new JButton(&quot;AC&quot;);
        point = new JButton(&quot;.&quot;);
        neg = new JButton(&quot;neg&quot;);

        textArea.setEditable(false);
        textArea.setFont(new Font(&quot;微软雅黑&quot;, Font.BOLD, 24));
        textArea.setHorizontalAlignment(SwingConstants.TRAILING);

        point.setFont(new Font(&quot;黑体&quot;, Font.BOLD, 18));
        delete.setFont(new Font(&quot;黑体&quot;, Font.BOLD, 15));

        delete.addActionListener(event -&gt; &#123;
            textArea.setText(&quot;0&quot;);
            calculator.reset();
        &#125;);
        point.addActionListener(new OperatorButtonListener(&quot;.&quot;));
        neg.addActionListener(new OperatorButtonListener(&quot;neg&quot;));

        for (int i = 0; i &lt; 10; i++) &#123;
            numberBtn[i] = new JButton(String.valueOf(i));
            numberBtn[i].addActionListener(new NumberButtonListener(i));
            numberBtn[i].setFont(new Font(&quot;黑体&quot;, Font.BOLD, 18));
            numberPanel.add(numberBtn[i]);
        &#125;

        numberPanel.add(point);
        numberPanel.add(delete);

        operatorPanel.add(neg);

        String[] temp = &#123;&quot;+&quot;, &quot;-&quot;, &quot;*&quot;, &quot;/&quot;, &quot;=&quot;&#125;;
        for (int i = 0; i &lt; operatorBtn.length; i++) &#123;
            operatorBtn[i] = new JButton(temp[i]);
            operatorBtn[i].setFont(new Font(&quot;黑体&quot;, Font.BOLD, 18));
            operatorBtn[i].addActionListener(new OperatorButtonListener(temp[i]));
            operatorPanel.add(operatorBtn[i]);
        &#125;


        centerPanel.add(BorderLayout.NORTH, textArea);
        centerPanel.add(BorderLayout.CENTER, numberPanel);
        centerPanel.add(BorderLayout.EAST, operatorPanel);

        this.add(BorderLayout.NORTH, northPanel);
        this.add(BorderLayout.CENTER, centerPanel);
        this.add(BorderLayout.SOUTH, southPanel);
        this.add(BorderLayout.EAST, eastPanel);
        this.add(BorderLayout.WEST, westPanel);

        this.pack();
        this.setSize(300, 300);
    &#125;

    public CalculatorFrame() &#123;
        initComponent();

        this.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
        this.setLocationRelativeTo(null);
        this.setVisible(true);
        this.setTitle(&quot;简易计算器&quot;);

        calculator = new Calculator();
    &#125;

    private class NumberButtonListener implements ActionListener &#123;
        private final int value;

        public NumberButtonListener(int value) &#123;
            this.value = value;
        &#125;

        @Override
        public void actionPerformed(ActionEvent e) &#123;
            if (calculator.isCalculated()) &#123;
                calculator.reset();
                textArea.setText(String.valueOf(value));
            &#125; else &#123;
                textArea.setText(textArea.getText() + value);
            &#125;

            calculator.inputNum(value);
        &#125;
    &#125;

    private class OperatorButtonListener implements ActionListener &#123;
        private final String value;

        public OperatorButtonListener(String value) &#123;
            this.value = value;
        &#125;

        @Override
        public void actionPerformed(ActionEvent e) &#123;
            try &#123;
                if (value.equals(&quot;=&quot;)) &#123;
                    textArea.setText(String.valueOf(calculator.getResult()));
                &#125; else &#123;
                    if (value.equals(&quot;neg&quot;) &amp;&amp; calculator.isCalculated()) &#123;
                        textArea.setText(“neg”);
                    &#125; else &#123;
                        textArea.setText(textArea.getText() + value);
                    &#125;
                    calculator.inputOperator(value);
                &#125;
            &#125; catch (ArithmeticException arithmeticException) &#123;
                calculator.reset();
                textArea.setText(&quot;Error Input&quot;);
            &#125;
        &#125;
    &#125;

    public static void main(String[] args) &#123;
        new CalculatorFrame();
    &#125;
&#125;
</code></pre>

  </article>

  
    
  <div class="nexmoe-post-copyright">
    <strong>本文作者：</strong>ShiJh<br>
    <strong>本文链接：</strong><a href="https://blog.pressed.top/2020/11/18/JavaSimpleCalculator/" title="https:&#x2F;&#x2F;blog.pressed.top&#x2F;2020&#x2F;11&#x2F;18&#x2F;JavaSimpleCalculator&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.pressed.top&#x2F;2020&#x2F;11&#x2F;18&#x2F;JavaSimpleCalculator&#x2F;</a><br>
    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/java-swing/" rel="tag">java swing</a>
    
</div>

  <div class="nexmoe-post-footer">
    <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
  </div>
</div>
        <div class="nexmoe-post-right">
          <div class="nexmoe-fixed">
            <div class="nexmoe-tool">
              <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
            </div>
          </div>
        </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>
 <script src="/js/app.js?v=1615614996172"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





</body>

</html>
