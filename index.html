<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ShiJh-Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="欢迎来到我的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="ShiJh-Blog">
<meta property="og:url" content="https://blog.pressed.top/">
<meta property="og:site_name" content="ShiJh-Blog">
<meta property="og:description" content="欢迎来到我的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ShiJh">
<meta property="article:tag" content="blog">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ShiJh-Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ShiJh-Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">学无止境</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.pressed.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-myBatis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/12/myBatis/" class="article-date">
  <time class="dt-published" datetime="2021-03-11T16:00:00.000Z" itemprop="datePublished">2021-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/12/myBatis/">MyBatis</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bird-MyBatis"><a href="#bird-MyBatis" class="headerlink" title=":bird:MyBatis"></a>:bird:MyBatis</h1><p>mybatis是一个优秀的持久层框架，通过配置的方式即可对数据库进行持久化操作。</p>
<blockquote>
<p>推荐IDEA插件<a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/8321-free-mybatis-plugin">FreeMyBatisPlugin</a>。</p>
</blockquote>
<h2 id="配置详解"><a href="#配置详解" class="headerlink" title="配置详解"></a>配置详解</h2><p><strong>Maven坐标</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="XML核心配置"><a href="#XML核心配置" class="headerlink" title="XML核心配置"></a>XML核心配置</h3><h4 id="运行环境配置"><a href="#运行环境配置" class="headerlink" title="运行环境配置"></a>运行环境配置</h4><p>运行环境需要指定数据库连接池和事务管理类型。完成以下配置即可完成最简单的持久化操作。</p>
<ul>
<li><p>数据源环境</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据源环境可以配置多个，其中指定一个ID为默认运行环境，配置DataSource的方法与Spring配置相似，同样可以使用properties文件。</p>
</li>
<li><p>加载映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;xml-url&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="详细配置"><a href="#详细配置" class="headerlink" title="详细配置"></a>详细配置</h4><ul>
<li><p><strong>environment</strong></p>
<p><code>transactionManager</code>：事务管理器类型，分为 JDBC、MANAGED</p>
<p><code>dataSource</code>：连接池类型，分为UNPOOLED、POOLED、JNDI，<strong>也可以指定一个实现<code>UnpooledDataSourceFactory</code>的类作为type，如果要使用第三方连接池就需要这么做</strong></p>
<p><code>JDBC</code>和<code>POOLED</code>是最常用的，其他功能不做解释。</p>
</li>
<li><p><strong>mapper</strong></p>
<p>加载映射器可以使用多种方式，如以下三种：</p>
<p><code>resource</code>：相对类路径，相当于<code>classpath:</code>，用于加载映射器配置文件</p>
<p><code>class</code>：加载类，通过全限定类名加载，用于加载实现映射器接口的类（注解配置）</p>
<p><code>packagename</code>：加载包名下所有的类，同样是用于注解配置</p>
</li>
<li><p><strong>properties</strong></p>
<p>加载配置文件，使用<code>resource=&quot;path&quot;</code>加载类下路径的文件，不需要加classpath</p>
</li>
<li><p><strong>typeAliases</strong></p>
<p>定义类型别名，用于简化全限定类名，创建别名和真名的映射关系。Mybatis内部将Java基础类型与包装器类型映射起来了，所以使用<code>int</code>、<code>double</code>等名称时，对应的是包装器类名。</p>
</li>
<li><p><strong>typeHanlder</strong></p>
<p>配置<a href="#typeHandler">自定义类型转处理器</a>，需要包裹在<code>typeHanlders</code>中，通过属性<code>handler=&quot;类全限定名&quot;</code>配置一个处理器。</p>
</li>
</ul>
<h3 id="XML映射关系配置"><a href="#XML映射关系配置" class="headerlink" title="XML映射关系配置"></a>XML映射关系配置</h3><h4 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h4><p>每个映射文件对应一个命名空间，需要在标签内指定。命名空间的作用同Java包，使用映射关系时，需要以命名空间为开头的路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;spaceName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="sql语句配置"><a href="#sql语句配置" class="headerlink" title="sql语句配置"></a>sql语句配置</h4><p><code>id</code>是语句的标识符，sql语句可以直接写在标签中。</p>
<ul>
<li><p>SELECT</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--resultType是返回结果的类型，指定一个类Mybatis能够自动封装--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;&quot;</span>&gt;</span>sql<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>UPDATE</p>
<p><code>&lt;update id=&quot;&quot; parameterType=&quot;&quot;&gt;sql&lt;/update&gt;</code></p>
</li>
<li><p>DELETE</p>
<p><code>&lt;delete id=&quot;&quot; &gt;sql&lt;/delete&gt;</code></p>
</li>
<li><p>INSERT</p>
<p><code>&lt;insert id=&quot;&quot; &gt;sql&lt;/insert&gt;</code></p>
</li>
</ul>
<h5 id="使用占位符"><a href="#使用占位符" class="headerlink" title="使用占位符"></a>使用占位符</h5><p>mybatis中占位符用<code>#&#123;name&#125;</code>表示，这个占位符是安全的，与Jdbc的<code>?</code>一样。在符号内部可以填写多个属性，如限定这个占位符的类型等，更多属性的设置请到官方文档中查询。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;id, javaType=int, jdbcType=NUMERIC&#125;</span><br></pre></td></tr></table></figure>

<p><strong>用实体对象作为占位符参数</strong></p>
<p>Mybatis具备将复杂对象的属性配置到占位符中的功能，其中对象的属性名需要和占位符内<code>name</code>的参数名保持一致，mybatis即可自动的配置到占位符中。</p>
<p>sql标签使用<code>parameterType</code>属性可以指定该条语句所需要的参数对象类型，在缺省的情况下Mybatis能够自动推断。</p>
<h4 id="ResultMap"><a href="#ResultMap" class="headerlink" title="ResultMap"></a>ResultMap</h4><p><a target="_blank" rel="noopener" href="https://github.com/838239178/SpringStudy/tree/master/mybatis_study/src">测试用例子</a></p>
<p>结果映射，通过<code>resultType</code>指定的类型，能够被mybatis自动创建并设置其中的属性值，当列名和属性名匹配上时，不需要额外配置，而复杂情况下可以通过显式配置<code>resultMap</code>的方式完成映射，大多数情况下ResultMap在配置一对一、一对多、多对多关联查询时使用。</p>
<ol>
<li> 配置一个所需的resultMap</li>
</ol>
   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span>  <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;class&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--把class的属性名同列名关联起来--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对一关系映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">assosiation</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;class&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">assosiation</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--一对多/多对多关系映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;class&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>   主键一般使用<code>&lt;id&gt;</code>标签来配置。</p>
<ol start="2">
<li> 将sql语句的<code>resultType</code>更换为<code>resultMap</code></li>
</ol>
   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">resultMap</span>=<span class="string">&quot;mapId&quot;</span>&gt;</span>sql<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps">更加复杂的高级结果映射请看官方文档</a>包含多表关系查询需要的复杂嵌套映射</p>
<h4 id="SelectKey"><a href="#SelectKey" class="headerlink" title="SelectKey"></a>SelectKey</h4><p>该标签用在增删改语句中，能够完成一次子查询并封装到参数中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;&quot;</span> <span class="attr">keyColumn</span>=<span class="string">&quot;&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;&quot;</span> <span class="attr">order</span>=<span class="string">&quot;&quot;</span>&gt;</span>sql<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>keyProperty</code>、<code>keyColumn</code> 配置映射关系，结果将保存到keyProperty对应参数中（可以是对象中的属性）</li>
<li><code>resultType</code> 返回结果对应的JavaType</li>
<li><code>order</code> 指定为BEFORE/AFTER，意为在主查询之前还是之后进行这个子查询</li>
</ul>
<p><em>SelectKey需要注意order属性，像Mysql一类支持自动增长类型的数据库中，order需要设置为after才会取到正确的值</em></p>
<h4 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h4><p>当一条语句被调用时，mybatis能够将其返回结果缓存起来，若有多次查询则可以使用缓存直接返回。</p>
<p>Select语句默认是打开缓存的，缓存开启方式如下：</p>
<p>在sql语句标签中添加属性<code>useCache=&quot;true&quot;</code>即可开启，当使用属性<code>flushCache=&quot;true&quot;</code>时，调用sql会刷新缓存区，默认为<code>false</code></p>
<h3 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h3><table>
<thead>
<tr>
<th>常用注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Insert, @Update, @Delete,   @Select</td>
<td>增删改查语句，填写sql语句，参数通用<code>#&#123;&#125;</code></td>
</tr>
<tr>
<td>@Result</td>
<td>映射封装结果，相当于xml中的id/result，使用column和property配置映射关系，使用<code>@One</code>/<code>@Many</code>作为参数配置复杂映射，参数<code>id=true</code>表明为主键</td>
</tr>
<tr>
<td>@Results</td>
<td>封装多个结果，相当于xml中的resultMap，组合多个<code>@Result</code>标签</td>
</tr>
<tr>
<td>@One</td>
<td>实现一对一查询封装，调用其他接口，完成子查询操作，返回单一的对象</td>
</tr>
<tr>
<td>@Many</td>
<td>实现一对多、多对多查询封装，调用其他接口，完成子查询操作，返回集合对象</td>
</tr>
<tr>
<td>@ResultMap</td>
<td>给<code>@Select</code>或者<code>@SelectProvider</code>提供在XML映射中的<code>&lt;resultMap&gt;</code>的id，参数为一个<code>int</code>数组</td>
</tr>
<tr>
<td>@Options</td>
<td>配置对应方法的sql属性，如flushCache、useCahce等，无法指定空值，所以一旦使用就受所有默认值的支配。</td>
</tr>
<tr>
<td>@SelectKey</td>
<td>提供在insert、update、delete时进行二次查询，并返回某些属性。参数<code>keyProperty</code>、<code>keyColumn</code>指定映射关系，<code>statement</code>指定sql语句，<code>before</code>代替order属性，使用bool决定，还有其他参数<a href="#SelectKey">同上文</a></td>
</tr>
</tbody></table>
<ul>
<li><p>一对一查询</p>
<p>原理是进行两次查询，第二次查询的条件取决于第一次查询得到的外键</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(id=true,column=&quot;&quot;,property=&quot;&quot;),</span></span><br><span class="line"><span class="meta">    // 进行一次子查询封装</span></span><br><span class="line"><span class="meta">   	@Resutl(</span></span><br><span class="line"><span class="meta">        property=&quot;&quot;,javaType=class,</span></span><br><span class="line"><span class="meta">        column=&quot;下一次查询使用哪一列的值&quot;</span></span><br><span class="line"><span class="meta">    	one=@One(select=&quot;接口方法全限定名&quot;)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;sql&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>一对多、多对多查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Result(</span></span><br><span class="line"><span class="meta">    @Result(</span></span><br><span class="line"><span class="meta">		/*省略相同部分*/</span></span><br><span class="line"><span class="meta">        many=@Many(select=&quot;&quot;)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Select(&quot;sql&quot;)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><p>在配置映射关系时，Mybatis提供了一系列标签，使得sql语句能够动态的生成。根据参数不同，在同一个标签下能够生成不同语句。</p>
<h3 id="动态标签"><a href="#动态标签" class="headerlink" title="动态标签"></a>动态标签</h3><p>动态标签是用于<code>select</code>等标签内部，用来动态生成sql语句的标签。</p>
<ul>
<li><p><code>&lt;where&gt;</code></p>
<p>用于包裹其他动态标签，防止不使用条件判断时造成sql语法问题，当<code>where</code>标签内没有生成任何sql语句时，不会在原有sql上加入where字段，反之则加上where字段。<em>（实际上是添加一个’ where 1=1 ‘）</em></p>
</li>
<li><p><code>&lt;if&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bool表达式&quot;</span>&gt;</span></span><br><span class="line">    sql</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>&lt;foreach&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;集合类型&quot;</span> <span class="attr">open</span>=<span class="string">&quot;开始字段&quot;</span> <span class="attr">close</span>=<span class="string">&quot;结束字段&quot;</span> <span class="attr">item</span>=<span class="string">&quot;name&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;分隔符&quot;</span>&gt;</span></span><br><span class="line">	sql，使用#&#123;name&#125;引用item</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>&lt;trim&gt;</code> 与where用法相似</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">perfix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">	sql</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">perfix</td>
<td align="center">给sql语句拼接的前缀</td>
</tr>
<tr>
<td align="center">suffix</td>
<td align="center">给sql语句拼接的后缀</td>
</tr>
<tr>
<td align="center">prefixOverrides</td>
<td align="center">去除sql语句前面的关键字或者字符，该关键字或者字符由prefixOverrides属性指定，假设该属性指定为”AND”，当sql语句的开头为”AND”，trim标签将会去除该”AND”</td>
</tr>
<tr>
<td align="center">suffixOverrides</td>
<td align="center">去除sql语句后面的关键字或者字符，该关键字或者字符由suffixOverrides属性指定</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="片段抽取"><a href="#片段抽取" class="headerlink" title="片段抽取"></a>片段抽取</h3><p><code>&lt;sql&gt;</code>片段标签，使用这个标签可以抽取重复片段，并使用标签id作为变量代替。</p>
<p><strong>创建sql片段</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span>sql<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>引用sql片段</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;sqlId&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注解使用动态SQL"><a href="#注解使用动态SQL" class="headerlink" title="注解使用动态SQL"></a>注解使用动态SQL</h3><p>Mybatis对注解方式的SQL也有动态功能的支持，一共有两种方法。</p>
<ol>
<li><p><strong>方法一</strong></p>
<p>在sql字符串内使用<code>&lt;script&gt;</code>把sql语句包裹起来，在<code>&lt;script&gt;</code>内部就能够使用上面讲到的标签了，用法相同，但需要注意内部的引号<code>”“</code>需要使用转义字符！</p>
</li>
<li><p><strong>方法二</strong></p>
<p>使用<code>@XXXProvider</code>标签，<code>XXX</code>包括Select、Insert等，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SelectProvider(type=A.class, method=&quot;mySelect&quot;)</span></span><br></pre></td></tr></table></figure>

<p><code>type</code>指定一个类，<code>method</code>指定一个方法的名称，该方法的参数应与接口方法参数相同方便判空，并返回一个<code>String</code>对象作为为Sql字符串。所以我们需要在方法中实现Sql的动态生成！</p>
<p>在这个方法中，Sql如何动态生成完全取决于我们自己，我们可以使用自己定义的逻辑来完成这个工作。但是Mybatis也为我们提供了一种选择——使用<code>SQL</code>对象构建sql语句。</p>
</li>
</ol>
<h4 id="SQL对象"><a href="#SQL对象" class="headerlink" title="SQL对象"></a>SQL对象</h4><p>SQL对象是一个构建Sql的工具类，可以很方便的构造一个Sql语句，使用其提供的<code>SELECT()</code>、<code>WHERER()</code>、<code>JOIN()</code>等方法来拼接字符串，且无需担心语法问题。</p>
<p>简单用例（来自官方文档）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匿名内部类风格</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deletePersonSql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SQL() &#123;&#123;</span><br><span class="line">    DELETE_FROM(<span class="string">&quot;PERSON&quot;</span>);</span><br><span class="line">    WHERE(<span class="string">&quot;ID = #&#123;id&#125;&quot;</span>);</span><br><span class="line">  &#125;&#125;.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder / Fluent 风格</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">insertPersonSql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  String sql = <span class="keyword">new</span> SQL()</span><br><span class="line">    .INSERT_INTO(<span class="string">&quot;PERSON&quot;</span>)</span><br><span class="line">    .VALUES(<span class="string">&quot;ID, FIRST_NAME&quot;</span>, <span class="string">&quot;#&#123;id&#125;, #&#123;firstName&#125;&quot;</span>)</span><br><span class="line">    .VALUES(<span class="string">&quot;LAST_NAME&quot;</span>, <span class="string">&quot;#&#123;lastName&#125;&quot;</span>)</span><br><span class="line">    .toString();</span><br><span class="line">  <span class="keyword">return</span> sql;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态条件（注意参数需要使用 final 修饰，以便匿名内部类对它们进行访问）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">selectPersonLike</span><span class="params">(<span class="keyword">final</span> String id, <span class="keyword">final</span> String firstName, <span class="keyword">final</span> String lastName)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SQL() &#123;&#123;</span><br><span class="line">    SELECT(<span class="string">&quot;P.ID, P.USERNAME, P.PASSWORD, P.FIRST_NAME, P.LAST_NAME&quot;</span>);</span><br><span class="line">    FROM(<span class="string">&quot;PERSON P&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (id != <span class="keyword">null</span>) &#123;</span><br><span class="line">      WHERE(<span class="string">&quot;P.ID like #&#123;id&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (firstName != <span class="keyword">null</span>) &#123;</span><br><span class="line">      WHERE(<span class="string">&quot;P.FIRST_NAME like #&#123;firstName&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lastName != <span class="keyword">null</span>) &#123;</span><br><span class="line">      WHERE(<span class="string">&quot;P.LAST_NAME like #&#123;lastName&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ORDER_BY(<span class="string">&quot;P.LAST_NAME&quot;</span>);</span><br><span class="line">  &#125;&#125;.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p>使用第三方插件或自己开发的插件对Mybatis的功能进行拓展</p>
<h3 id="配置Plugin"><a href="#配置Plugin" class="headerlink" title="配置Plugin"></a>配置Plugin</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;类全限定名&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://search.maven.org/artifact/com.github.pagehelper/pagehelper/">pageHelper</a></p>
<p>非常好用的分页插件，简单的参数设定，简单的数据获取。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="自定义插件"><a href="#自定义插件" class="headerlink" title="自定义插件"></a>自定义插件</h3><p>实现<code>Interceptor</code>接口，主要实现三个方法</p>
<ol>
<li><p>核心方法，通过<code>invocation</code>参数能够获得映射好的sql语句，该方法的返回值是invocation对象proceed方法的返回值，与<a href="https://blog.pressed.top/javaweb#proxymode">Proxy代理模式</a>一样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>主要用来将对象封装成代理对象，确保<code>interceptI()</code>能够被调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 一般都是通过该方法封装</span></span><br><span class="line">    <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>提供插件自定义属性，这个方法的属性能够在配置阶段进行注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="配置拦截注解"><a href="#配置拦截注解" class="headerlink" title="配置拦截注解"></a>配置拦截注解</h4><p>在自定义插件类完成后，需要使用注解<code>@Intercepts</code>来表明该插件需要拦截的方法签名。</p>
<p>Mybatis只允许拦截以下类中的方法：</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>ParameterHandler (getParameterObject, setParameters)</li>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
<li>StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;@Signature(</span></span><br><span class="line"><span class="meta">  type= Executor.class,</span></span><br><span class="line"><span class="meta">  method = &quot;update&quot;,</span></span><br><span class="line"><span class="meta">  args = &#123;MappedStatement.class,Object.class&#125;)&#125;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>@Singnature</code>：表示一个构造一个方法签名<ul>
<li>type：被拦截类名</li>
<li>method：被拦截类中的方法名</li>
<li>args：被拦截方法的参数</li>
</ul>
</li>
</ul>
<h2 id="JAVA-API"><a href="#JAVA-API" class="headerlink" title="JAVA-API"></a>JAVA-API</h2><p>使用mybatis提供的java开发包，用java对数据库进行持久化操作。</p>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><p>快速入门演示了mybatis-api的一个基本使用流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 加载核心配置</span></span><br><span class="line">InputStream configStream = Resources.getResourcesAsStream(<span class="string">&quot;sqlMapConfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">//2. 获得SqlSession工厂对象</span></span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(configStream);</span><br><span class="line"><span class="comment">//3. SqlSession对象</span></span><br><span class="line">SqlSession session = factory.openSession();</span><br><span class="line"><span class="comment">//4. 执行sql语句</span></span><br><span class="line">List&lt;Object&gt; list = session.selectList(<span class="string">&quot;mapping-parttern&quot;</span>);</span><br><span class="line"><span class="comment">// 提交事务</span></span><br><span class="line">session.commit();</span><br><span class="line"><span class="comment">//5. 释放SqlSession</span></span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<h3 id="常用对象详解"><a href="#常用对象详解" class="headerlink" title="常用对象详解"></a>常用对象详解</h3><ul>
<li><p>SqlSession</p>
<p>mybatis主要的java接口，一切数据库操作都是由这个对象完成的。其地位类似于JdbcTemplate，在使用spring时也能通过IOC进行注入。</p>
<p>主要方法有<code>selectXxx()</code>、<code>update()</code>、<code>delete()</code>以及事务管理的<code>commit、rollback</code>等</p>
</li>
<li><p>SqlSessionFactoryBuilder</p>
<p>用于创建SqlSessionFactory的对象，其中构建方法为<code>build()</code>，支持使用<code>InputStream</code>加载配置文件来创建工厂对象。</p>
</li>
<li><p>SqlSessionFactory</p>
<p>创建SqlSession对象的工厂类，用<code>openSession()</code>方法创建，可以使用其重载来设置SqlSession的一些属性，如是否自动提交事务以及事物的隔离级别等。</p>
<p>引用官方文档的一段话</p>
<blockquote>
<p>SqlSessionFactory 有六个方法创建 SqlSession 实例。通常来说，当你选择其中一个方法时，你需要考虑以下几点：</p>
<ul>
<li><strong>事务处理</strong>：你希望在 session 作用域中使用事务作用域，还是使用自动提交（auto-commit）？（对很多数据库和/或 JDBC 驱动来说，等同于关闭事务支持）</li>
<li><strong>数据库连接</strong>：你希望 MyBatis 帮你从已配置的数据源获取连接，还是使用自己提供的连接？</li>
<li><strong>语句执行</strong>：你希望 MyBatis 复用 PreparedStatement 和/或批量更新语句（包括插入语句和删除语句）吗？</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="DAO层接口代理"><a href="#DAO层接口代理" class="headerlink" title="DAO层接口代理"></a>DAO层接口代理</h3><p>Mybatis能够将编写的<code>Mapper.xml</code>通过Java的接口进行动态代理，使得开发人员调用dao接口就能完成mapper中定义的数据库操作。使用接口代理的有以下的条件约束：</p>
<ol>
<li>mapper中<strong>namesapce</strong>属性的值需要为所需接口的全限定名。</li>
<li>mapper中每个定义的sql语句<strong>id</strong>属性需要与接口中的方法名一一对应。</li>
<li>sql语句的参数类型、结果类型即为接口方法的参数和返回值。</li>
<li>接口的设计不能使用重载。</li>
</ol>
<p>:information_source:<em>使用IDEA插件能够根据数据库关系自动生成实体和接口</em></p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p>通过<code>SqlSession</code>的<code>getMapper(dao.class)</code>获得接口的代理对象，直接使用接口即可。</p>
<h3 id="typeHandler"><a href="#typeHandler" class="headerlink" title="typeHandler"></a>typeHandler</h3><p>类型处理器，在Mybatis生成<code>PreparedStatement</code>或获取结果时会调用类型处理器来转化sql所需的参数。Mybatis默认使用了许多转换器，在使用时能够自动推断类型使用响应转换器，也能事先通过<code>parameterType</code>、<code>resultType</code>指明参数类型。</p>
<h4 id="自定义typeHandler"><a href="#自定义typeHandler" class="headerlink" title="自定义typeHandler"></a>自定义typeHandler</h4><p>类型转换器需要实现<code>TypeHandler</code>接口或继承<code>BaseTypeHandler&lt;T&gt;</code>类，泛型为需要自定义转化的Java类。</p>
<ul>
<li><p>parameter转化逻辑</p>
<p>当mybatis设置数据到数据库时调用，使用这个方法来自定义参数转化逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="keyword">int</span> i, T obj, </span></span></span><br><span class="line"><span class="function"><span class="params">                                JdbcType jdbcType)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//直接使用preparedStatement的set方法设置参数&#x27;obj&#x27;，参数的index为&#x27;i&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>result转化逻辑</p>
<p>从数据库取出数据时调用的转化方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从三类不同的结果集取出给定的数据并转化成Java数据，第二个参数即为结果集中所需参数的位置</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, String s)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="keyword">int</span> i)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2021/03/12/myBatis/" data-id="ckm77mrjg000laghj4v60dya4" data-title="MyBatis" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-web/" rel="tag">java web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javaweb" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/12/javaweb/" class="article-date">
  <time class="dt-published" datetime="2021-03-11T16:00:00.000Z" itemprop="datePublished">2021-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/12/javaweb/">Java Web</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="JavaWeb-Spring"><a href="#JavaWeb-Spring" class="headerlink" title="JavaWeb-Spring"></a>JavaWeb-Spring</h1><blockquote>
<p>GitHub：<a target="_blank" rel="noopener" href="https://github.com/838239178/SpringStudy">Spring学习过程中创建的项目，包含一些例子</a></p>
</blockquote>
<ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="一​、-walking-JavaSE"><a href="#一​、-walking-JavaSE" class="headerlink" title="一​、:walking:JavaSE"></a>一​、:walking:JavaSE</h2><ul>
<li><input checked="" disabled="" type="checkbox"> Java语言基础内容，已经掌握</li>
</ul>
<h2 id="二、-horse-JSP-Servlet"><a href="#二、-horse-JSP-Servlet" class="headerlink" title="二、:horse:JSP/Servlet"></a>二、:horse:JSP/Servlet</h2><p>主要以理解Tomcat中Servlet的运行原理为重点</p>
<h3 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h3><p>Jsp本质是servlet，约等于分不清前后端，耦合性太强，已经被时代抛弃，大概了解即可，直接跳过学习。</p>
<h4 id="JSTL"><a href="#JSTL" class="headerlink" title="JSTL"></a>JSTL</h4><p>JavaServer Pages Tag Library ：JSP标准标签库</p>
<p>用于简化和替换jsp页面上的java 代码</p>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><ul>
<li><p><strong>Servlet</strong>: </p>
<p>注解声明<code>@WebServlet(&quot;path&quot;)</code></p>
<p>tomcat服务器的核心，主要是理解Http协议、<code>HttpServletRequest</code>以及<code>HttpServletResponse</code>原理。req可以进行转发<code>forward</code>（服务器内servlet间转发），resp可以进行重定向<code>redirect</code>(由浏览器发送第二次请求，可跨服务器)</p>
</li>
<li><p><strong>Filter</strong>：</p>
<p>注解声明<code>@WebFilter(&quot;path&quot;)</code></p>
<p>过滤器，拦截request和response，可以对req和resp进行判断是否放行。</p>
</li>
<li><p><strong>Listener</strong>：</p>
<p>注解声明<code>@WebListener</code></p>
<p>监听器，<code>ServletContextListener</code>监听ServletContext对象的创建（服务器启动）和销毁（服务器关闭），该接口主要用于加载资源和释放资源等操作。除此之外还有其他监听器。</p>
</li>
<li><p>ServletContext： </p>
<p>服务器内的一个全局上下文，可以从servlet或req中获取（单例类）。作用是获取服务器真实路径<code>getRealPath()</code>、设置和获取服务器内共享的数据域<code>set/getAttribute()</code>和获取Content-type<code>getMimeType(filename)</code>，通过配置<code>&lt;context-param&gt;</code>可以用<code>getInitParam()</code>来加载资源文件</p>
</li>
<li><p>Cookie：保存于浏览器的数据，用来识别身份，保存sessionid等。可以设置存活周期。</p>
</li>
</ul>
<ul>
<li>Session：保存于服务器的数据，用来记录每个浏览器特定的信息，由一个id对应。可以设置存活周期，服务器关闭后会<code>钝化</code>，再次开启后<code>活化</code></li>
</ul>
<h3 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h3><p>语法：<code>$&#123;expression&#125;</code></p>
<ol>
<li><p>运算</p>
<p>算数运算、比较运算、逻辑运算、判空运算<code>empty</code></p>
</li>
<li><p><strong>获取值</strong></p>
<p>从域对象中获取值<code>$&#123;域名称.keyName&#125;</code>、<code>$&#123;keyName&#125;</code></p>
<table>
<thead>
<tr>
<th>域名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>pageScope</td>
<td>从pageContext获取</td>
</tr>
<tr>
<td>requestScope</td>
<td>从request中获取</td>
</tr>
<tr>
<td>sessionScope</td>
<td>从session中获取</td>
</tr>
<tr>
<td>applicationScope</td>
<td>从ServletContext获取</td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="ExtraDetail"><a href="#ExtraDetail" class="headerlink" title="ExtraDetail"></a>ExtraDetail</h3><p>这里记录在学习这个模块的过程中额外学习到的内容。</p>
<h4 id="ProxyMode"><a href="#ProxyMode" class="headerlink" title="ProxyMode"></a>ProxyMode</h4><p>代理模式，软件设计模式的一种，通过中间代理执行方法，来达到增强的目的。后续框架中经常使用该模式。</p>
<p>动态代理在Java中使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfacies, InvocationHandler h)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>InvocationHandler</code>是抽象类，需实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>通过在该方法中调用<code>method.invoke(obj,args)</code>来执行被代理的对象的方法。可以<strong>修改返回值</strong>或者<strong>参数</strong>等手段来增强该方法，也可以在方法调用前和调用后增加其他类的方法。</p>
<h4 id="MVC开发模式"><a href="#MVC开发模式" class="headerlink" title="MVC开发模式"></a>MVC开发模式</h4><ol>
<li><p><strong>M:</strong> Model 模型 <code>JavaBean</code></p>
<p>完成业务逻辑操作，如查询数据库、封装数据</p>
</li>
<li><p><strong>V:</strong> View 视图 <code>jsp</code></p>
<p>展示数据</p>
</li>
<li><p><strong>C:</strong> Controller 控制器 <code>servlet</code></p>
<p>分发工作，获取客户端的输入然后调用模型，将数据交给视图。</p>
</li>
</ol>
<h4 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h4><ol>
<li><p>界面层（表示层 web）<code>SpringMVC</code></p>
<p>用户能够通过界面的组件和服务器进行交互，调用Service完成请求处理，转发jsp页面完成显示。</p>
<ul>
<li>控制器：servlet，接受用户请求并封装参数信息到Servic层</li>
<li>视图：JSP，接受控制器提供的数据并展示出来给用户</li>
</ul>
</li>
<li><p>业务逻辑层 (service) <code>Spring</code></p>
<p>处理业务逻辑，组合DAO层的简单方法，组成各种复杂的业务功能。</p>
</li>
<li><p>数据访问层 (dao) <code>MyBatis</code></p>
<p>操作数据存储文件，定义了对数据库最基本的CRUD操作</p>
</li>
</ol>
<h4 id="Bootstrap-JQuery-AJAX"><a href="#Bootstrap-JQuery-AJAX" class="headerlink" title="Bootstrap/JQuery/AJAX"></a>Bootstrap/JQuery/AJAX</h4><p>皆为前端框架</p>
<ul>
<li><p>Boostrap</p>
<p>提供丰富的html标签和css样式，具有响应式布局，配合JQuery/Vue使用。</p>
</li>
<li><p>JQuery</p>
<p>对js的封装，提供了选择器等许多丰富API来帮助编写js动态生成页面。</p>
</li>
<li><p>AJAX</p>
<p>异步的JavaScript和XML，用于向服务器发送异步请求，可以在JQuery/Vue中便捷使用。</p>
</li>
</ul>
<h2 id="三​、-bike-JDBC-SQL"><a href="#三​、-bike-JDBC-SQL" class="headerlink" title="三​、:bike:JDBC/SQL"></a>三​、:bike:JDBC/SQL</h2><p>两者是数据库的重要内容，SQL有<code>MySQL、SQLserver</code>等，<code>JDBC</code>则是Java操作数据库SQL的重要API，都应熟练掌握并理解原理。</p>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>学会数据库增删查改等操作，熟练运用操控数据库的高级技巧，重点理解数据库原理，学会优化数据库。</p>
<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><h5 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h5><p>事务指的是一个包含多个步骤的业务操作，如果这个操作被事务管理，则要么同时成功，要么同时失败。事务可以提供回滚操作，撤销出错的影响。</p>
<ul>
<li><code>ＳＴＡＲＴ　ＴＲＡＮＳＡＣＴＩＯＮ</code>　开启事务管理</li>
<li><code>ＲＯＬＬＢＡＣＫ</code>　回滚</li>
<li><code>ＣＯＭＭＩＴ</code>　提交事务</li>
</ul>
<p><code>SELECT @@autocommit</code> 查看是否为自动提交，修改后可以改变默认管理方式</p>
<h5 id="四大特征"><a href="#四大特征" class="headerlink" title="四大特征"></a>四大特征</h5><ul>
<li>原子性：数据库操作中不可分割的最小单位，要么同时成功，要么同时失败</li>
<li>持久性：事务提交或回滚后，数据会持久化保存在数据库中</li>
<li>隔离性：多个事务之间相互独立</li>
<li>一致性：事务操作前后，数据总量不变</li>
</ul>
<h5 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h5><p>多个事务操作同一批数据会引发一些问题，通过设置隔离级别可以解决这些问题。</p>
<ul>
<li>脏读：一个事务，读取到另一个事务中没有提交的数据。</li>
<li>不可重复读：同一个事务中，两次读取到的数据不一样（可能被另一个事务修改了）<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/55872397">MySql-MVCC原理</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B9%BB%E8%AF%BB/153502?fr=aladdin">幻读</a>：一个事务(同一个read view)在前后两次查询同一范围的时候，后一次查询看到了前一次查询没有看到的行。</li>
</ul>
<table>
<thead>
<tr>
<th>级别</th>
<th>说明</th>
<th>安全性</th>
</tr>
</thead>
<tbody><tr>
<td>read uncommitted</td>
<td>读未提交，允许读取未提交的数据</td>
<td>0</td>
</tr>
<tr>
<td>read committed</td>
<td>当前读、读已提交，只有已经提交的数据才能被读取</td>
<td>1</td>
</tr>
<tr>
<td>repeatable read</td>
<td>可重复读，使一个事务周期内的数据不受其他事务影响</td>
<td>2</td>
</tr>
<tr>
<td>serializable</td>
<td>串行化，锁定一张表，相当于单线程执行事务</td>
<td>3</td>
</tr>
</tbody></table>
<p><em>从小到大安全性越来越高，效率越来越低！不同的数据库隔离级别原理不同，如MySql的MMVC，因此能解决的问题也不同</em></p>
<p>通过<code>SELECT @@tx_isolation</code>查询隔离级别，<code>SET GLOBAL TRANSACTION ISOLATION LEVEL 级别名</code>设置隔离级别 </p>
<h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><p>JDBC是Java用来操作数据库的接口，具体实现由不同数据库公司实现，他的实现类被称为<strong>“驱动”（Driver）</strong>。</p>
<p><strong>常见驱动类：</strong></p>
<ul>
<li>MySql：”com.mysql.jdbc.Driver”</li>
<li>SqlServer：”com.microsoft.sqlserver.jdbc.SQLServerDriver”</li>
</ul>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><ol>
<li><p>注册驱动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 通过该方法把类加载到内存</span></span><br><span class="line"><span class="comment"> 驱动类来自每个不同的数据库公司，以下是mysql的驱动类</span></span><br><span class="line"><span class="comment"> 该方法执行时，类的静态代码块会被执行，Driver会使用registerDriver方法注册DriverManager</span></span><br><span class="line"><span class="comment"> mysql5以上的版本可以省略这个注册过程</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>获取数据库连接对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> url: 数据库地址 jdbc:mysql://域名:端口/dbName</span></span><br><span class="line"><span class="comment"> user: 管理员用户名</span></span><br><span class="line"><span class="comment"> pwd: 管理员密码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Connection conn = DriverManager.getConnection(url,user,pwd);</span><br></pre></td></tr></table></figure></li>
<li><p>定义sql语句<code>String</code></p>
</li>
<li><p>获取执行sql对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">//satement 可以执行sql语句</span></span><br><span class="line">Statement stat = conn.createStatement();</span><br></pre></td></tr></table></figure></li>
<li><p>执行sql获取返回结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sqlStr 为数据库执行语句，如DML(insert、update、delete)、DDL(create、alter、drop)</span></span><br><span class="line"><span class="comment">//返回影响的行数：可以通过这个值判断DML语句是否执行成功</span></span><br><span class="line">stat.excuteUpdate(sqlStr);</span><br></pre></td></tr></table></figure></li>
<li><p>释放资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行对象释放</span></span><br><span class="line">stat.close();</span><br><span class="line"><span class="comment">//数据库连接释放</span></span><br><span class="line">conn.close();</span><br><span class="line"><span class="comment">//结果对象释放</span></span><br><span class="line">resultSet.close();</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="常用对象详解"><a href="#常用对象详解" class="headerlink" title="常用对象详解"></a>常用对象详解</h4><p>   <strong>Connection：</strong></p>
<ul>
<li><p>获取sql对象</p>
<p><code>createStatement()</code>、<code>preparedStatement(sqlStr)</code></p>
</li>
<li><p>管理事务</p>
<p>关闭自动提交事务的功能即可开启手动事务管理</p>
<p>开启：<code>setAutoCommit(false)</code>、提交：<code>commit()</code>、回滚：<code>rollback()</code></p>
</li>
</ul>
<p>   <strong>Statement：</strong></p>
<ul>
<li><code>excuteUpdate(sql)</code>：执行DML(insert、update、delete)、DDL(create、alter、drop)，返回影响的行数</li>
<li><code>executeQuery(sql)</code>：执行DQL(select)语句，返回<code>ResultSet</code></li>
</ul>
<p>   <strong>ResultSet：</strong></p>
<ul>
<li><p><code>next()</code>：移动游标到下一行，游标初始于第0行（表头），如果下一行没有数据则返回false</p>
</li>
<li><p><code>getXxx(int/str)</code>  </p>
<p>获取当前行的数据，<code>Xxx</code>为数据类型名，返回类型为<code>Xxx</code></p>
<p>方法指定参数为int时，表示columIndex获取第几列的数据</p>
<p>方法指定参数为str时，表示columName获取名为str的列的数据 </p>
</li>
</ul>
<p>   <strong>PreparedStatement：</strong></p>
<ul>
<li><p>解决SQL注入问题</p>
<p>某些sql特殊关键字参与字符串拼接会造成安全性问题，如<code>WHERE</code>后存在恒等式则表示没有约束作用</p>
</li>
<li><p>预编译sql</p>
<p>sql语句的参数使用<code>？</code>占位符，使用<code>setXxx(pos, value)</code>方法赋值，该方法传入占位符的位置（第几个）和值来进行sql参数补充，value类型为<code>Xxx</code></p>
</li>
<li><p><code>excuteUpdate()</code></p>
</li>
<li><p><code>executeQuery()</code></p>
</li>
</ul>
<h4 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h4><p>事务指的是一个包含多个步骤的业务操作，如果这个操作被事务管理，则要么同时成功，要么同时失败。</p>
<ul>
<li>开启 提交 回滚 <a href="#%E5%B8%B8%E7%94%A8%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3">使用Connection管理</a></li>
</ul>
<h5 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    conn.setAutoCommit(<span class="keyword">false</span>); <span class="comment">//open</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> do sql</span></span><br><span class="line">    conn.commit(); <span class="comment">//commit if no exception occur</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    conn.rollback(); <span class="comment">//rollback if has any exception </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当<code>rollback()</code>执行时，刚刚执行的sql操作都会撤销。</p>
<h4 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h4><p>优化Connection操作，提高数据库访问性能</p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>使用连接对象容器管理Connection，从容器中获取，归还到容器中去，由容器管理是否断开连接。</p>
<h5 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h5><p>*Interface <strong>DataSource</strong>：*由<a href="#JDBC">Driver</a>实现，Druid性能较高</p>
<ol>
<li><p><strong>C3P0</strong>：ComboPooledDataSource</p>
<p>使用classpath:<code>c3p0.properties/c3p0-config.xml</code>配置参数</p>
</li>
<li><p><strong>Druid</strong>：DruidDataSourceFactory</p>
<p>使用<code>druid.properties</code>配置参数，需要手动加载。通常封装成工具类静态加载配置文件。</p>
</li>
</ol>
<h4 id="Spring-JdbcTemplete"><a href="#Spring-JdbcTemplete" class="headerlink" title="Spring JdbcTemplete"></a>Spring JdbcTemplete</h4><p>由Spring封装的JDBCUtils，简化操作。<a href="#Spring-JdbcTemplate">详细见下文</a></p>
<h3 id="Junit4"><a href="#Junit4" class="headerlink" title="Junit4"></a>Junit4</h3><p>Junit单元测试属于白盒测试的一种。</p>
<h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Before</td>
<td>在所有测试方法前执行</td>
</tr>
<tr>
<td>@After</td>
<td>在所有测试方法后执行，无论是否存在异常</td>
</tr>
<tr>
<td>@Test</td>
<td>标注方法为测试方法</td>
</tr>
</tbody></table>
<h4 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h4><p>所有测试方法都是无参的，测试方法内最好不要直接输出数值，应该尽量使用<code>assert</code>断言结果于预期是否相符合。对于测试期间出现的异常应该尽量捕获并写入文件中，标明异常方法和异常原因。</p>
<h3 id="Redis-Jedis"><a href="#Redis-Jedis" class="headerlink" title="Redis/Jedis"></a>Redis/Jedis</h3><p>非关系型数据库，有缓存功能。。。</p>
<h2 id="四、-car-SSM"><a href="#四、-car-SSM" class="headerlink" title="四、:car:SSM"></a>四、:car:SSM</h2><p>JavaWeb框架集合之一，由<code>Spring+SpringMVC+Mybatis</code>组成，适用于轻量级微服务开发，要深入理解原理。</p>
<h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><p>Spring框架属于Service层框架，但是也管理了Web层和DAO层</p>
<h4 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h4><h5 id="ioc容器"><a href="#ioc容器" class="headerlink" title="ioc容器"></a>ioc容器</h5><p>Bean容器，spring在内部创建Java类，我们或Spring可以从容器中取出Bean</p>
<h5 id="XML式依赖注入"><a href="#XML式依赖注入" class="headerlink" title="XML式依赖注入"></a>XML式依赖注入</h5><p>对<code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;&lt;/bean&gt;</code>对象的属性进行配置</p>
<p>分别为：对象注入<code>ref</code>、普通数据类型注入<code>value</code>、集合类型</p>
<ul>
<li><p>集合类型：配置文件使用<code>&lt;list&gt;&lt;value&gt;</code>、<code>&lt;map&gt;&lt;entry key=&quot;&quot; value-ref=&quot;&quot;&gt;</code>、<code>&lt;props&gt;&lt;prop key=&quot;&quot;&gt;</code>组合使用 </p>
</li>
<li><p>构造方法：有参构造，配置文件中使用<code>&lt;constructor-arg name=&quot;&quot; ref=&quot;&quot;/&gt;</code>注入</p>
</li>
<li><p>set方法：配置文件中使用<code>&lt;property name=&quot;&quot; ref=&quot;&quot;/&gt;</code>子标签标签设置属性值注入</p>
</li>
</ul>
<p><strong>模块开发</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;applicationContext-xxx.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="注解式依赖注入"><a href="#注解式依赖注入" class="headerlink" title="注解式依赖注入"></a>注解式依赖注入</h5><ol>
<li><p><strong>原始注解</strong></p>
<p>使用前须在配置文件中配置组件扫描，指定需要注解开发的包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于排除不需要被扫描的类--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Component</td>
<td>类上实例化Bean，代替Bean标签</td>
</tr>
<tr>
<td align="left">@Controller</td>
<td>web层类上实例化Bean</td>
</tr>
<tr>
<td align="left">@Respository</td>
<td>dao层上实例化Bean</td>
</tr>
<tr>
<td align="left">@Service</td>
<td>service层上实例化Bean</td>
</tr>
<tr>
<td align="left">@Autowired</td>
<td>依赖注入标签，加在成员变量/setter/构造方法</td>
</tr>
<tr>
<td align="left">@Qualifier</td>
<td>结合Autowired一起使用根据名称进行依赖注入</td>
</tr>
<tr>
<td align="left">@Resource</td>
<td>相当于前两者的结合，是javaEE的注解，不是Spring的注解</td>
</tr>
<tr>
<td align="left">@Value</td>
<td>注入普通属性（int等）</td>
</tr>
<tr>
<td align="left">@PostConstruct</td>
<td>声明Bean的初始化方法</td>
</tr>
<tr>
<td align="left">@PreDestroy</td>
<td>声明Bean的销毁方法</td>
</tr>
<tr>
<td align="left">@Scope</td>
<td>标志Bean的范围，singleton/prototype</td>
</tr>
</tbody></table>
</li>
<li><p><strong>新注解</strong></p>
<p>可以完全替代xml配置文件</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Configuration</td>
<td>指定类为配置类，创建容器时从该类上加载注解</td>
</tr>
<tr>
<td>@ComponentScan</td>
<td>指定要扫描的包，同<code>&lt;context:componnet-scan&gt;</code>，使用excludeFilters排除不需要被扫描的类</td>
</tr>
<tr>
<td>@Bean</td>
<td>标注方法的返回值储存于容器中</td>
</tr>
<tr>
<td>@PropertySource</td>
<td>用于加载<code>.properties</code>文件的配置</td>
</tr>
<tr>
<td>@Import</td>
<td>用于导入其他配置类</td>
</tr>
</tbody></table>
</li>
</ol>
<h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><h5 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h5><p>面向切面编程，是动态代理的规范化编程，动态代理如何增强方法见上文。SpringAOP底层使用的动态代理为以下两种：</p>
<ol>
<li><p>Java原生接口代理</p>
<p>通过接口反射出代理对象，使用的是 <a href="#ProxyMode">ProxyMode</a></p>
</li>
<li><p>cglib子类代理</p>
<p>外部的工具库，已经集成在springframework-core中，使用的是Enhancer类。通过指定父类反射出代理对象。</p>
</li>
</ol>
<p>根据<u>目标对象</u><a href="%E8%A2%AB%E4%BB%A3%E7%90%86%E7%9A%84%E7%B1%BB">^目标对象</a>是否有接口来选择其中一个方法。</p>
<p>[^切入点]: pointCut 目标对象的方法<br>[^连接点]: 目标对象被增强的方法<br>[^通知]: advice 用于增强连接点的方法</p>
<h5 id="XML配置动态代理"><a href="#XML配置动态代理" class="headerlink" title="XML配置动态代理"></a>XML配置动态代理</h5><p>maven导入依赖<code>aspectjweaver</code>、<code>spring-aop</code></p>
<ol>
<li><p>配置目标对象和切面对象Bean</p>
<p><strong>切面类和目标类都需要配置为Bean</strong>才能被Spring从IOC容器中取出来</p>
</li>
<li><p>配置织入（前置、后置……）</p>
<p>使用命名空间<code>xmlns:aop</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!--声明切面类--&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;beanName&quot;</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--配置切面：切点+通知--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--类似的还有aop:after等等--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;adviceName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(&#x27;方法声明&#x27;)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>切面标签</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="left">标签</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">前置通知</td>
<td align="left">aop:before</td>
<td>略</td>
</tr>
<tr>
<td align="center">后置通知</td>
<td align="left">aop:after-returning</td>
<td>略</td>
</tr>
<tr>
<td align="center">环绕通知</td>
<td align="left">aop:around</td>
<td>前后都执行，比前置更前，比后置更后</td>
</tr>
<tr>
<td align="center">异常抛出通知</td>
<td align="left">aop:throwing</td>
<td>出现异常时执行</td>
</tr>
<tr>
<td align="center">最终通知</td>
<td align="left">aop:after</td>
<td>最后执行，无论是否抛出异常</td>
</tr>
</tbody></table>
<p>:information_source:<strong>环绕通知</strong>方法需要携带参数<code>ProceedingJoinPoint</code>表示连接点[^连接点]对象，要在方法中执行该对象的<code>proceed()</code>方法并<strong>return</strong>该方法的返回值。</p>
<p>:warning:<strong>环绕通知</strong>方法的返回值都为<code>Object</code>，表示被增强的方法会返回一个对象或者<code>NULL</code>，因此需要注意被增强的方法不能返回<code>boolean</code>、<code>int</code>等基础类型，需要用对应的包装类替换！</p>
</li>
<li><p>切点表达式</p>
<p><code>execution([修饰符] 返回值 包名.类名.方法(参数))</code></p>
<ul>
<li><p>修饰符可以省略（public、private……）</p>
</li>
<li><p>可以用通配符（*）代表任意</p>
</li>
<li><p>参数可以用<code>..</code>表示任意个数，任意类型的参数列表（可变参数）</p>
</li>
</ul>
<p>ex:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* cn.test.*.*(..)) <span class="comment">//cn.test包下任意类的任意方法</span></span><br></pre></td></tr></table></figure>

<p><strong>表达式抽取：</strong>替换<code>point-cut</code>为<code>point-cut-ref</code>，引用<code>&lt;aop:pointcut id=&quot;&quot; expression=&quot;&quot;/&gt;</code>标签设定好的表达式<u>id</u></p>
</li>
</ol>
<h5 id="注解配置动态代理"><a href="#注解配置动态代理" class="headerlink" title="注解配置动态代理"></a>注解配置动态代理</h5><p>在配置文件中添加<code>&lt;aop:aspect-autoproxy /&gt;</code>自动代理aop</p>
<p>或者在配置类上用<code>@EnableAspectJAutoProxy</code>标注</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Aspect</td>
<td>标注为切面类</td>
</tr>
<tr>
<td>@Before</td>
<td>标志为前置通知，参数为execution表达式</td>
</tr>
<tr>
<td>@AfterReturning</td>
<td>标志为后置通知，参数为execution表达式</td>
</tr>
<tr>
<td>@Around</td>
<td>标志为环绕通知，参数为execution表达式</td>
</tr>
<tr>
<td>@AfterThrowing</td>
<td>标志为异常抛出通知，参数为execution表达式</td>
</tr>
<tr>
<td>@After</td>
<td>标志为最终通知，参数为execution表达式</td>
</tr>
</tbody></table>
<p><strong>切点[^切入点]表达式抽取：</strong>在切面类中定义空实现方法，在方法上用<code>@PointCut（’表达式‘）</code>标注，引用时按照<code>className.methodName()</code>来描述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Aspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PointCut(&quot;excution(*.cn.shijh.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myPointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(Aspect.myPointCut())</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeEnhance</span><span class="params">()</span>    </span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<h4 id="Spring事务控制"><a href="#Spring事务控制" class="headerlink" title="Spring事务控制"></a>Spring事务控制</h4><p>底层基于<a href="#aop">AOP</a>实现事务管理，一般在Service层进行。</p>
<p>切点：Service方法</p>
<p>通知：事务管理</p>
<hr>
<p>:warning: :warning: :warning: <a href="https://blog.pressed.top/springTxError">关于这个问题的详细说明</a></p>
<p><strong>Spring事务管理与AOP之间存在神坑，被环绕通知的方法是无法进行事务控制的！！！！坑了我两三个小时！原因是事务管理本身就是环绕通知！！解决办法：设定Aspect和advisor的Order，且事务控制的Order要比环绕通知的大，否则无法完成事务回滚</strong></p>
<hr>
<h5 id="编程式控制"><a href="#编程式控制" class="headerlink" title="编程式控制"></a>编程式控制</h5><ol>
<li> <strong>PlatfromTransactionManager</strong></li>
</ol>
<p>   spring事务管理器的接口，依据不同Dao层技术使用不同的实现类。</p>
<ul>
<li> <em>DataSourceTransactionManager</em></li>
</ul>
<pre><code> Jdbc or MyBatis 对应的实现类。
</code></pre>
<ol start="2">
<li> <strong>TransacitonDefinition</strong></li>
</ol>
<p>   事务的定义对象，封装事务的隔离级别、传播行为、超时时间等属性。</p>
<ul>
<li><p><a href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">隔离级别</a></p>
<p><code>ISOLATION_DEFAULT</code>：数据库默认级别</p>
<p><code>ISOLATION_READ_UNCOMMITTED</code></p>
<p><code>ISOLATION_READ_COMMITTED</code></p>
<p><code>ISOLATION_REPEATABLE_READ</code></p>
<p><code>ISOLATION_SERIALIZABLE</code></p>
</li>
<li><p>传播行为</p>
<p><code>REQUIRED</code>：默认值，防止嵌套的两个事务发生，后一个事务会加入到前一个事务中。</p>
<p><code>SUPPORTS</code>：后一个事务将不会开启</p>
<p><code>MANDATORY</code>：强制加进入前一个事务中，没有前一个事务就报错</p>
</li>
</ul>
<ol start="3">
<li><p><strong>TransactionStatus</strong></p>
<p> 事务的运行状态对象。是否完成、是否回滚等状态。</p>
</li>
</ol>
<h5 id="XML声明式控制"><a href="#XML声明式控制" class="headerlink" title="XML声明式控制"></a>XML声明式控制</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置事务管理的增强方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--name可以使用通配符‘*’和字符串组合使用</span></span><br><span class="line"><span class="comment">			如‘update*’表示以update开头的所有方法名--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;&quot;</span> <span class="attr">propogation</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--transactionManager需要注入到IOC容器中--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置增强方法的织入，使用aop--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务管理增强专用标签--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;tx:advice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution&quot;</span>/&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>标签</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>tx:advice</td>
<td>配置事务管理的通知，需指定transactionManager</td>
</tr>
<tr>
<td>tx:attributes</td>
<td>配置<a href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E6%8E%A7%E5%88%B6">事务的属性</a>，具体由多个<a href="tx:method">tx:method</a>配置</td>
</tr>
<tr>
<td>tx:method</td>
<td>指定一个方法名，配置一个业务方法的属性，包括隔离级别等</td>
</tr>
<tr>
<td>aop:advisor</td>
<td>用于事务管理的aop增强方法，引用配置好的<a href="tx:advice">tx:advice</a>作为通知</td>
</tr>
</tbody></table>
<p><em>配置事务属性时，只需指定方法名，不需要指定包名类名等，具体位置在织入时配置</em></p>
<h5 id="注解声明式控制"><a href="#注解声明式控制" class="headerlink" title="注解声明式控制"></a>注解声明式控制</h5><table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@EnableTransactionManagement</td>
<td>在配置类中标注，表示开启spring事务管理</td>
</tr>
<tr>
<td>@Transactional</td>
<td>在方法或者类上标注，表示类下的方法都会被spring事务进行管理，可以加参数来配置<a href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E6%8E%A7%E5%88%B6">事务的属性</a></td>
</tr>
</tbody></table>
<p><em>使用注解配置时，driver会由spring自动配置，只需要将transactionManager放到IOC容器中</em></p>
<h4 id="Spring-Junit"><a href="#Spring-Junit" class="headerlink" title="Spring-Junit"></a>Spring-Junit</h4><p>通过注解集成Junit</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@RunWith</td>
<td>指定使用Spring内置的测试类</td>
</tr>
<tr>
<td>@ContextConfiguration</td>
<td>指定Spring配置文件、配置类</td>
</tr>
<tr>
<td>@AutoWired</td>
<td>从IOC容器中注入测试对象</td>
</tr>
</tbody></table>
<h4 id="Spring-JdbcTemplate"><a href="#Spring-JdbcTemplate" class="headerlink" title="Spring-JdbcTemplate"></a>Spring-JdbcTemplate</h4><p>对<a href="#jdbc">JDBC</a> API的封装，使调用更加简单</p>
<p>maven需要导入依赖<code>spring-jdbc</code>和<code>spring-tx</code></p>
<p><strong>常用方法</strong></p>
<ol>
<li><p><code>setDataSource()</code>：设置连接池对象</p>
</li>
<li><p><code>update()</code>、<code>query()</code>：执行sql语句</p>
</li>
<li><p><code>RowMapper&lt;T&gt;</code>可以自动完成数据封装的接口，是<code>query()</code>的方法参数，对应实现类有 <code>BeanPropertyRowMapper&lt;T&gt;</code>，需要构造参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> BeanPropertyRowMapper&lt;JavaBean&gt;(JavaBean.class)</span><br></pre></td></tr></table></figure>

<p><code>query()</code>将返回<code>List&lt;T&gt;</code>类型的集合</p>
</li>
<li><p><code>queryForObject()</code>同<code>query()</code>一样，但是只返回一个对象</p>
</li>
<li><p> 查询简单对象只需要传入<code>Class&lt;T&gt;</code></p>
</li>
</ol>
<p>可以使用IOC容器来创建jdbcTemplate、dataSource对象，完成参数的注入。</p>
<h4 id="Spring-web"><a href="#Spring-web" class="headerlink" title="Spring-web"></a>Spring-web</h4><p>用于集成web环境的maven依赖<code>spring-web</code>，提供获取应用上下文（ApplicationContext）的工具类和监听器。获取的原理是在服务器启动时创建上下文并放入ServletContext域中，即可在服务器共享。方便在 <code>Servlet</code>中获取应用上下文，且可以避免多次创建带来的性能开销。</p>
<ol>
<li><p>web.xml中配置监听器<code>ContextLoaderListener</code></p>
</li>
<li><p>配置<code>&lt;context-param&gt;</code>指定applicationContext.xml/.class的路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>xx.xx.xx.ClassName<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果使用类配置则一定要指定下面的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>WebApplicationContextUtils</code>获取上下文</p>
</li>
</ol>
<h3 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><p><a target="_blank" rel="noopener" href="https://github.com/838239178/springdemo">Spring+SpringMvc Demo</a></p>
<p>属于web层框架，提供轻量级的MVC开发 ，核心是用<code>servlet</code>实现的前端控制器。该控制器执行servlet的共有行为，并调用特有行为servlet，称为 <code>Controller</code></p>
<h4 id="组件解析"><a href="#组件解析" class="headerlink" title="组件解析"></a>组件解析</h4><h5 id="原理图解"><a href="#原理图解" class="headerlink" title="原理图解"></a>原理图解</h5><p><img src="https://i.loli.net/2021/02/26/OyFfPTpuwKC7jEo.jpg"></p>
<h5 id="组件详解"><a href="#组件详解" class="headerlink" title="组件详解"></a>组件详解</h5><ul>
<li><p>HandlerMapping</p>
</li>
<li><p>HandlerAdaptor</p>
<p>执行对应的Controller，并把Controller的返回值包装成ModelAndView对象。</p>
</li>
<li><p>ModelAndView</p>
<ul>
<li><code>setViewName()</code>设置页面跳转的页面名称</li>
<li><code>addObject()</code>设置request域中的参数</li>
<li><code>new ModelAndView(JsonView, ModelMap)</code>用一个Map和JsonView对象创建Json数据视图</li>
</ul>
</li>
<li><p>ViewResolver</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zmx729618/article/details/51554762">参考地址</a></p>
<p>视图解析器，SpringMvc内部有很多解析器，默认使用的 <code>InternalResourceViewResolver</code>。主要作用是把一个ModelAndView解析为一个真正的视图。</p>
<p>其中一种视图解析使用了一种拼接url的方式，内部规定了前缀(prefix)、后缀(suffix)，与视图的名称，如”index”，拼接后就得到视图URL了。url方式可以在<code>ViewName</code>中加上前缀指定，有”redirect:”和”forward:”，表示重定向和转发。视图解析器会把这些包装成View对象返回前端控制器。</p>
</li>
<li><p>View</p>
<p>由解析器产生的对象，分为URL(jsp, jstl)、文档(excel, pdf)、报表、JSON。</p>
</li>
</ul>
<h4 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h4><ol>
<li><p>在<code>web.xml</code>中配置前端控制器<code>DispatcherServlet</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设定SpringMVC配置文件的地址 使用类配置时要指定contextClass类型，同spring-web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>配置文件地址<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用独立的<code>spring-mvc.xml</code>配置SpringMVC的各种属性</p>
<ul>
<li><p>配置组件，ViewResolver、HandleAdapter等</p>
<p>用<code>&lt;bean&gt;</code>标签配置，同Spring一样 </p>
</li>
</ul>
</li>
<li><p><code>&lt;mvc:annotation-driven&gt;</code> 自动配置一些组件的属性</p>
</li>
</ol>
<h4 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h4><p><a href="#%E6%B3%A8%E8%A7%A3%E5%BC%8F%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">Spring新注解也通用于SpringMVC</a></p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
<th align="left">参数</th>
</tr>
</thead>
<tbody><tr>
<td>@EnableWebMvc</td>
<td>启用mvc注解驱动</td>
<td align="left">无</td>
</tr>
<tr>
<td>@RequestMapping</td>
<td>请求映射地址，用于类或方法中</td>
<td align="left">value：路径；method：请求方式；params：限定请求参数</td>
</tr>
<tr>
<td>@GetMapping</td>
<td>Request的细分</td>
<td align="left">value：路径</td>
</tr>
<tr>
<td>@PostMapping</td>
<td>同上</td>
<td align="left">同上</td>
</tr>
<tr>
<td>@ResponseBody</td>
<td>标注返回值到content中</td>
<td align="left">无</td>
</tr>
<tr>
<td>@RequestParam</td>
<td>取request的参数</td>
<td align="left">value：所需参数的名称; require：强制要求？;defaultValue：默认值</td>
</tr>
<tr>
<td>@RequestBody</td>
<td>标注方法参数上，注入JSON请求参数</td>
<td align="left">无</td>
</tr>
<tr>
<td>@PathVariable</td>
<td>标注方法参数上，用于restful风格的参数</td>
<td align="left">value；require；defaultValue; 同RequestParam</td>
</tr>
<tr>
<td>@RequstHeader</td>
<td>获取请求头数据</td>
<td align="left">value; require;</td>
</tr>
</tbody></table>
<p><strong>WebMvcConfigurer</strong></p>
<p>Mvc配置类需要实现的接口，用于配置更多SpringMvc的属性，如资源解析、拦截器等。</p>
<h5 id="注解配置web-xml"><a href="#注解配置web-xml" class="headerlink" title="注解配置web.xml"></a>注解配置web.xml</h5><p>配置web.xml的类需要实现接口<code>AbstractAnnotationConfigDispatcherServletInitializer</code>，并实现其中方法，Spring会自动查找该实现类来代替web.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定 ContextLoaderListener 所需的配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定mvc的核心配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等同于设置 DispatcherServlet 的 url-pattern</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> String[] getServletMappings() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Filter[]&#123;</span><br><span class="line">        <span class="keyword">new</span> CharacterEncodingFilter(<span class="string">&quot;UTF-8&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数据响应"><a href="#数据响应" class="headerlink" title="数据响应"></a>数据响应</h4><p>服务的的数据响应分为页面跳转和回写数据。</p>
<h5 id="页面跳转"><a href="#页面跳转" class="headerlink" title="页面跳转"></a>页面跳转</h5><ol>
<li><p>直接返回字符串，如页面的名称”index”，默认为转发</p>
</li>
<li><p>返回ModelAndView对象</p>
<p>通过<code>setViewName()</code>指定页面名称，<code>addObject()</code>保存数据供<code>JSP</code>调用</p>
<p>ModelAndView对象可以放在形参中，Spring会自动注入一个空的对象。</p>
</li>
</ol>
<h5 id="回写数据"><a href="#回写数据" class="headerlink" title="回写数据"></a>回写数据</h5><ol>
<li><p>ModelAndView</p>
<p>Json数据内容由<code>LinkedHashMap</code>转化而来，Json转化驱动可以是<code>jackjson</code>、<code>fastjson</code>，需要添加maven依赖。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> FastJsonJsonView(), map);</span><br></pre></td></tr></table></figure></li>
<li><p>字符串</p>
<p>方法上标注<code>@ResponseBody</code>表示返回值直接写入response的content。Json也可以作为字符串直接返回，使用json驱动转化。</p>
</li>
<li><p>对象或集合</p>
<p>通过配置消息转换器，可以直接返回集合或者对象自动转化成Json字符串，同时要在方法上标注<code>@ResponseBody</code>。</p>
<ul>
<li><p>XML</p>
<p>配置<code>RequestMappingHandlerAdapter</code>bean标签，把Json转化驱动注入<code>messageConverters</code>中。</p>
</li>
<li><p>注解、类配置</p>
<p>在Mvc配置类中继承<code>WebMvcConfigurer</code>接口，实现以下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 此处配置FastJson</span></span><br><span class="line">    FastJsonConfig config = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">    FastJsonHttpMessageConverter converter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">    config.setSerializerFeatures(</span><br><span class="line">        SerializerFeature.DisableCircularReferenceDetect,</span><br><span class="line">        SerializerFeature.WriteMapNullValue,</span><br><span class="line">        SerializerFeature.WriteNullStringAsEmpty</span><br><span class="line">    );</span><br><span class="line">    converter.setFastJsonConfig(config);</span><br><span class="line">    converters.add(converter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><em>*返回Map集合时，最好使用<strong>LinkedHashMap</strong>来保证Json内数据顺序不会乱掉</em></p>
</li>
</ol>
<h5 id="获得请求参数"><a href="#获得请求参数" class="headerlink" title="获得请求参数"></a>获得请求参数</h5><ol>
<li><p>spring自动注入方法的参数中</p>
<p>限制：基本类型、数组和 Javabea(POJO)。集合对象（List等）需要包装到Bean中才能自动注入。当方法参数名与请求参数名一致时不需要加<code>@RequestParam</code></p>
</li>
<li><p><code>@RequestBody</code>直接接收request的参数数据</p>
<p>注释在参数上，一般用于非表单的数据，如<code>application/json</code>、<code>application/xml</code></p>
<p>用Json格式的数组作为<strong>请求参数</strong>，可以通过该标签直接注入到集合类型的<strong>方法参数</strong>中。</p>
</li>
<li><p>获得<a href="#Restful">Restful</a>风格的请求参数</p>
<p>使用<code>@PathVariable</code>获取，具体使用如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequsetMapping(&quot;/api/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testController</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id, <span class="meta">@PathVariable(&quot;name&quot;)</span> Stirng name)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>获取<strong>请求头</strong></p>
<p>使用<code>@RequstHeader(name)</code>在方法参数中注入。</p>
<p><code>@CookieValue</code>直接获取Cookie数据。</p>
</li>
</ol>
<h5 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h5><p>Post Content类型为 <code>Multipart/form-data</code>时，需要借助第三方工具简化获取参数的过程。</p>
<p>导入maven依赖 <code>commons-io</code>、<code>commons-fileupload</code></p>
<p>SpringMvc获取到上传的文件时，会打包成<code>MulitpartFile</code>对象，因此用于获取文件的Controller方法需要有此类型的参数。</p>
<p><strong>MultipartFile</strong></p>
<ul>
<li><code>getOriginFilename()</code>获取文件名</li>
<li><code>transferTo(File)</code>通过IO保存本地或其他服务器</li>
</ul>
<h5 id="自定义类型转换器"><a href="#自定义类型转换器" class="headerlink" title="自定义类型转换器"></a>自定义类型转换器</h5><p>实现 <code>Convert&lt;S,D&gt;</code> 接口，并配置到SpringMvc中。接口泛型分别为转换前类型和转换后类型。 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h4><p>当 spring-mvc 的 dispatcher-servlet 路径配置为<code>/</code>，访问资源时也会去寻找Handler，无法访问到资源文件。解决方法有两种，第一种是配置资源文件的映射，第二种是交由tomcat来寻找资源文件。</p>
<ul>
<li><p>XML配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.配置资源文件的映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resource</span> <span class="attr">mapping</span>=<span class="string">&quot;url&quot;</span> <span class="attr">location</span>=<span class="string">&quot;path&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--2.启用默认servlet-handler管理资源文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注解、类配置 </p>
<p>在Mvc配置类中继承<code>WebMvcConfigurer</code>接口，实现以下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">     configurer.enable();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Session管理"><a href="#Session管理" class="headerlink" title="Session管理"></a>Session管理</h4><p>SpringMvc可以使用注解对Session进行一些简单的管理操作，如向session域中存入数据等。</p>
<ol>
<li><p><strong>方法一：</strong></p>
<p>在Controller方法中使用HttpSession对象作为参数，Spring会自动注入。HttpSession能够同时完成添加、删除、查询Attribute的功能。</p>
</li>
<li><p><strong>方法二：</strong></p>
<p>在Controller类上使用<code>@SessionAttributes</code>并指定参数为该类需要使用的AttributeNames，然后方法上的参数就可以使用<code>@ModelAttribute(name)</code>注入Session域的数据。在方法参数中使用Model类型，Spring会把该类的所有Session注入到Model对象中，因此也能够获取Session中的值，同时能够<strong>向Session中添加值</strong>。需要注意的是，使用该方法清除Session时，需要使用SessionStatus（作为方法参数，spring自动注入）的<code>SetComplete()</code>来清除，并且只会清除<code>@SessionAttributes</code>中标记的键值对。</p>
</li>
</ol>
<p>:hand:<em>Spring官方文档中提出，对于用户登录验证的session最好使用<strong>方法一</strong></em></p>
<h4 id="拦截器-Interceptor"><a href="#拦截器-Interceptor" class="headerlink" title="拦截器 Interceptor"></a>拦截器 Interceptor</h4><p>与Filter过滤器类似，用于预处理和后处理，原理为<a href="#AOP">AOP</a>。<strong>只对控制器方法进行拦截，不拦截资源访问</strong></p>
<h5 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h5><p>实现<code>HandlerInterceptor</code>接口，并进行配置。</p>
<ul>
<li><p>类配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span></span>&#123;</span><br><span class="line">    registry.addInterceptor(interceptor).addPathPatterns(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">bean</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>HandlerInterceptor</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行前拦截</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(req, resp, handler)</span></span>;	</span><br><span class="line"><span class="comment">// 执行后，返回前拦截</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(req,resp, handler, modelAndView)</span></span>;</span><br><span class="line"><span class="comment">// 流程完毕后拦截</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(req, resp, handler, exception)</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>preHandle</code>返回为 <code>True</code> 时，后续操作才能执行。</li>
<li><code>Handler</code>为控制器方法执行对象（Method）</li>
</ol>
</li>
</ul>
<h5 id="拦截器执行顺序"><a href="#拦截器执行顺序" class="headerlink" title="拦截器执行顺序"></a>拦截器执行顺序</h5><p>多个拦截器执行时，并非串行，而是嵌套的，也就是说拦截器执行链最后执行的方法时第一个拦截器的<code>afterCompletion</code>。执行的顺序与配置的顺序有关，先配置先执行。</p>
<h4 id="异常处理机制"><a href="#异常处理机制" class="headerlink" title="异常处理机制"></a>异常处理机制</h4><p>把异常处理抽取出来，通过异常处理组件统一解决，在SpringMvc中异常处理可以由<code>DispatcherServlet</code>调用响应组件处理。</p>
<h5 id="异常处理器"><a href="#异常处理器" class="headerlink" title="异常处理器"></a>异常处理器</h5><p><em>HandlerExceptionResolver</em></p>
<ul>
<li><p><strong>SimpleMappingExceptionResolver</strong></p>
<p>框架自带的实现类。Mapping——发生异常时跳转到异常视图，映射关系通过配置完成。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.xx.x.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defalutErrorView&quot;</span> <span class="attr">vlaue</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="自定义异常处理器"><a href="#自定义异常处理器" class="headerlink" title="自定义异常处理器"></a>自定义异常处理器</h5><ul>
<li><p>异常处理方法</p>
<p>使用注解<code>@ExceptionHanlder</code>标注在方法上时，该方法为所在类的异常处理方法。</p>
</li>
<li><p>异常处理类</p>
<p>使用注解<code>@ControllerAdvice</code>标注在类上时，该类为全局的异常处理类。类内的方法使用<code>@ExceptionHandler</code>标注的方法将用于处理发生的异常。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
<th>参数</th>
</tr>
</thead>
<tbody><tr>
<td>@ExceptionHanlder</td>
<td>用于方法上，异常处理方法</td>
<td>可以指定异常类，表示只处理个别异常</td>
</tr>
<tr>
<td>@ControllerAdvice</td>
<td>用于类上，全局的异常处理类</td>
<td>无</td>
</tr>
</tbody></table>
<p><em>*异常处理方法，会被当做一个Controller处理，因此其返回值最终会包装成ModelAndView对象，所以可以使用 <code>@ResponseBody</code>注解</em></p>
<h4 id="使用MockMvc集成Junit"><a href="#使用MockMvc集成Junit" class="headerlink" title="使用MockMvc集成Junit"></a>使用MockMvc集成Junit</h4><p>由于SpringMvc面向web层，因此无法直接调用Controller组件进行测试。</p>
<h5 id="使用方法-2"><a href="#使用方法-2" class="headerlink" title="使用方法"></a>使用方法</h5><ol>
<li>在Junit测试类上注解<code>@WebAppConfiguration</code>引入Web层配置文件</li>
<li>使用IOC注入<code>WebApplicationContext</code>对象</li>
<li>使用<strong>MockMvcBuilders</strong>创建<strong>MockMvc</strong>对象，需要传入WebApplicationContext初始化</li>
<li>使用MockMvc进行测试</li>
</ol>
<h5 id="MockMvc"><a href="#MockMvc" class="headerlink" title="MockMvc"></a>MockMvc</h5><p>MockMvc主要使用<code>perform()</code>方法向Controller发出请求，无需启动Tomcat服务器。<code>perfrom</code>方法的参数由<code>MockMvcRequestBuilders</code>创建，并返回一个<code>ResultActions</code>对象。</p>
<ul>
<li><code>MockMvcRequestBuilders</code>：创建一个模拟请求，有get或post类型，能够设置请求体和请求头参数</li>
<li><code>ResultActions</code>：通常使用<code>andDo</code>方法输出请求和响应的所有信息，执行<code>andReturn</code>返回<code>MvcResult</code>结果对象</li>
<li><code>MvcResult</code>：结果对象，包含request和response信息</li>
</ul>
<p><strong>测试样例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    MvcResult res = mockMvc.perform(</span><br><span class="line">        MockMvcRequestBuilders</span><br><span class="line">        .post(<span class="string">&quot;/user/login&quot;</span>)</span><br><span class="line">        .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span><br><span class="line">        .characterEncoding(<span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">        .param(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">        .param(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">    ).andDo(MockMvcResultHandlers.print()).andReturn();</span><br><span class="line">    System.out.println(res.getResponse().getContentAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mybatis-Spring"><a href="#Mybatis-Spring" class="headerlink" title="Mybatis-Spring"></a>Mybatis-Spring</h3><p>前置-关于Mybatis的详细内容：<a href="https://blog.pressed.top/myBatis">Mybatis原始教程</a></p>
<p><strong>Maven</strong>：mybatis-spring</p>
<h4 id="IOC注入"><a href="#IOC注入" class="headerlink" title="IOC注入"></a>IOC注入</h4><p>将Mybatis的<code>SqlSessionFactory</code>等对象配置到SpringIOC容器中。</p>
<ol>
<li><p>配置<code>SqlSessionFactory</code>，主要是配置其数据源<code>dataSource</code>和核心配置文件<code>configLocation</code>（非必须）</p>
</li>
<li><p>mapper组件扫描</p>
<p>注解方式：</p>
<ul>
<li><code>@MapperScan(basepackage=&quot;&quot;)</code></li>
</ul>
<p>简洁方式：</p>
<ul>
<li><code>&lt;mybatis:scan base-package=&quot;&quot; /&gt;</code>，这个方式不需要额外注解，但是也支持配置自定义注解来限制其扫描范围，指定<code>annotation</code>为自定义的注解即可。以上两种方法将映射器(DAO)z注入到SpringIOC时，默认使用首字母小写作为Bean的名称，可以在自定义注解中设置<code>org.springframework.stereotype.Component</code> 这样的注解既可以作为标记，也可以作为一个名字提供器来使用了。</li>
</ul>
<p>经典方式（不推荐使用了）：</p>
<ul>
<li><pre><code class="xml">&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;xx.xx&quot;/&gt;
&lt;/bean&gt;
</code></pre>
</li>
</ul>
</li>
</ol>
<p>配置完毕后即可使用依赖注入直接创建<code>DAO/Mapper</code>接口对象。</p>
<h4 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h4><p>配置事务管理器<code>transactionManager</code>和事务增强，同样可以使用注解，<a href="#Spring%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6">同上文</a>。配置完成后就可以像使用JdbcTempelate一样进行事务管理。</p>
<h3 id="ExtraDetail-1"><a href="#ExtraDetail-1" class="headerlink" title="ExtraDetail"></a>ExtraDetail</h3><h4 id="Properties-ResourceBundle"><a href="#Properties-ResourceBundle" class="headerlink" title="Properties/ResourceBundle"></a>Properties/ResourceBundle</h4><p>properties是一种键值对<code>key=value</code>储存文件，Java中自带的Properties类可以简单的读写properties文件，但是ResourceBundle类更好的支持了不同的语言，比前者要好一点。</p>
<h4 id="Restful"><a href="#Restful" class="headerlink" title="Restful"></a>Restful</h4><p>Restful是一种软件架构、设计风格，提供了一些原则和约束，可以帮助软件设计变得更加简介有层次，更易于实现缓存机制等。Restful风格表现为“url+请求方式”来表现一次HTTP请求，特点是请求参数用<code>/</code>接在url后面，而不再使用<code>?</code>来表示请求参数。如：<code>http://url/api?id=1</code>使用restful风格后应该是<code>http://url/api/1</code>。</p>
<p>Restful规定请求方式具有如下几个含义:</p>
<ul>
<li>GET 表示获取</li>
<li>POST 表示新建</li>
<li>PUT 表示更新</li>
<li>DELETE 表示删除</li>
</ul>
<h4 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson"></a>FastJson</h4><p>由阿里巴巴开发的Json转化驱动。其中<code>FastJsonHttpMessageConverter</code>可以用于SpringMvc的消息转换器中。</p>
<ul>
<li><code>@JSONType</code>: 可以标注在类上，通过指定orders参数可以决定转化该类时解析属性的顺序。</li>
<li><code>@JSONFiled</code>: 标注在成员变量上，可以指定转化后名称以及转化顺序。</li>
</ul>
<h2 id="五、-boat-SpringBoot"><a href="#五、-boat-SpringBoot" class="headerlink" title="五、:boat:SpringBoot"></a>五、:boat:SpringBoot</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2021/03/12/javaweb/" data-id="ckm77mrjv000naghjdp7adno3" data-title="Java Web" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-web/" rel="tag">java web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-springTxError" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/springTxError/" class="article-date">
  <time class="dt-published" datetime="2021-02-20T16:00:00.000Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/springTxError/">关于Spring事务管理失效问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="关于Spring事务管理失效问题"><a href="#关于Spring事务管理失效问题" class="headerlink" title="关于Spring事务管理失效问题"></a>关于Spring事务管理失效问题</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>学习 <a href="https://blog.pressed.top/javaweb">Java Web</a>学到了Spring的事务管理，在实际使用过程中发现，<code>@Transcational</code>与 <code>@EnableTranscationManagement</code> 组合使用时，出现了事务管理失效、无法回滚的问题，在网上搜索一番依然无法得到答案，后来在自己的冥思苦想下联想起Spring事务管理本质时AOP的结论时恍然大悟，于是通过逐个注释来测试其他切面的方法终于得到答案——环绕通知导致了无法进行事务回滚！</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p>得知无法进行事务管理的原因是环绕通知时，我开始思考原因，通过查阅网上资料，得知Spring执行AOP切面遵循着一定的顺序，而这个顺序是由 <code>Order</code> 属性决定的！然后我就通过更改<code>Order</code>的方式对环绕通知的切面和事务管理切面进行测试，最终得出原因为<strong>事务切面的优先级高于环绕通知切面的优先级时，事务管理无法执行（回滚）</strong></p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><h3 id="快速解决办法"><a href="#快速解决办法" class="headerlink" title="快速解决办法"></a>快速解决办法</h3><p>解决办法由上文非常容易得知，需要通过以下方法修改<code>Order</code>的值，需要注意的是该值越大，优先级越低，而事务切面默认值为<code>Integer.MAX_VALUE</code>，默认是优先级最低的，但是同样的其他Aspect默认值也是<code>Integral.MAX_VALAUE</code>，具体原因本人愚昧未知。所以说以下配置可以忽略事务管理切面的优先级Order的配置，只更改其他Aspect的Order。</p>
<h4 id="XML式配置"><a href="#XML式配置" class="headerlink" title="XML式配置"></a>XML式配置</h4><p>在以下两个标签中添加配置order属性值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">order</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">order</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="注解式配置"><a href="#注解式配置" class="headerlink" title="注解式配置"></a>注解式配置</h4><p>普通切面类通过<code>@Order</code> 注释传入一个<code>int</code>值即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(10086)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>事务管理切面需要在<code>@EnableTranscationManagement</code>中配置<code>order</code>参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement(order = 1008611)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优雅的解决办法"><a href="#优雅的解决办法" class="headerlink" title="优雅的解决办法"></a>优雅的解决办法</h3><p>如果按照以上方法配置Order难免会在项目越来越大的情况变得难以管理，因为是耦合在代码上的所以不利于管理，所以我们最优雅的解决办法是使用.<code>properties</code>配置文件。</p>
<h4 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h4><p>这个就是引用properties罢了，没什么好讲的，学过Spring XML配置都应该知道如何引入properties文件然后通过<code>$&#123;keyName&#125;</code>访问。</p>
<h4 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h4><p>因为注解配置使用的是<code>Java</code>代码，且本人暂未发现Spring框架本身对Order批量管理的支持，所以只好自己想一套简单但又良好的方法，从贴合框架啊本身的角度来讲，使用XML配置更符合:leaves:Spring框架的生态。</p>
<ol>
<li><p>创建properties文件，并在<strong>配置类</strong>中使用<code>@PropertySource</code>加载</p>
</li>
<li><p>让你的Aspect类继承<code>org.springframework.core.Ordered</code>接口并按照如下来实现接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> <span class="keyword">implements</span> <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;keyName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> order;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="关于解决方法"><a href="#关于解决方法" class="headerlink" title="关于解决方法"></a>关于解决方法</h4><p>注解配置的解决方法可能不够完美，但是也很好的进行解耦了，还有一些比较方便的方法但是实现难度较大，比如动态代理注解，用类名代替注解内的参数，来避免每次创建类都要用<code>@Value</code>注入order，然后就可以再配置文件中直接使用类名作为<code>key</code>配置Order了，目前动态代理注释的方法仍不清楚，所以暂时放弃这种方案。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2021/02/21/springTxError/" data-id="ckm77mrja0008aghj16hg4ieg" data-title="关于Spring事务管理失效问题" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-web/" rel="tag">java web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-signUpBaiduOcr" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/14/signUpBaiduOcr/" class="article-date">
  <time class="dt-published" datetime="2021-02-13T16:00:00.000Z" itemprop="datePublished">2021-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/14/signUpBaiduOcr/">使用BaiduOcr识别图片文字</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="使用BaiduOcr识别图片文字"><a href="#使用BaiduOcr识别图片文字" class="headerlink" title="使用BaiduOcr识别图片文字"></a>使用BaiduOcr识别图片文字</h1><p>百度AI平台提供了很多AI接口，大部分都提供了免费的调用额度，如果是个人使用可以获得很大的便利，这里将介绍如何使用百度提供的文字识别接口。</p>
<h2 id="注册并申请使用权"><a href="#注册并申请使用权" class="headerlink" title="注册并申请使用权"></a>注册并申请使用权</h2><p><a target="_blank" rel="noopener" href="https://ai.baidu.com/">BaiduAI官网</a>进入后点击右上角控制台进行登录</p>
<h3 id="注册百度账号"><a href="#注册百度账号" class="headerlink" title="注册百度账号"></a>注册百度账号</h3><p>百度账号注册这里不再赘述，进入控制台登陆时即可注册。</p>
<h3 id="实名认证"><a href="#实名认证" class="headerlink" title="实名认证"></a>实名认证</h3><ol>
<li><p>登入控制台后会要求填写以下信息来激活账号，只需要填写<code>*</code>号信息栏。</p>
<img src="https://i.loli.net/2021/02/14/SK3zbi5NUAHoPOj.jpg" alt="#1" style="zoom: 67%;" /></li>
<li><p>完成后点击左侧工具栏的文字识别，如下图所示</p>
<img src="https://i.loli.net/2021/02/14/bAF5XQBje4CSOHR.jpg" alt="#2" style="zoom: 50%;" /></li>
<li><p>点击<strong>立即认证</strong>，填入姓名和身份后点击下一步，无需刷脸验证，直接返回上一步的页面即可</p>
<img src="https://i.loli.net/2021/02/14/YUC32t7WH6xpiID.jpg" alt="#3" style="zoom:80%;" /></li>
</ol>
<h3 id="创建文字识别应用"><a href="#创建文字识别应用" class="headerlink" title="创建文字识别应用"></a>创建文字识别应用</h3><ol>
<li><p>回到控制台后点击 <strong>创建应用</strong>，填一些信息，<strong>不需要包名</strong>并选择所属为<strong>个人</strong></p>
<img src="https://i.loli.net/2021/02/14/uIH4jaeSwGJxEXp.jpg" alt="#4"  /></li>
<li><p>创建完成后点击 <strong>应用详情</strong> ，进入页面后请记住<code>API Key</code>和<code>Secret Key</code></p>
<img src="https://i.loli.net/2021/02/14/xZ8SFYnuoUJwRgp.jpg" alt="#5" style="zoom:80%;" /></li>
</ol>
<h2 id="调用API识别图片"><a href="#调用API识别图片" class="headerlink" title="调用API识别图片"></a>调用API识别图片</h2><h3 id="获取Token"><a href="#获取Token" class="headerlink" title="获取Token"></a>获取Token</h3><p>每隔一段时间使用前都需要获取<code>Token</code>，一个Token的有效期为30分钟</p>
<p>通过发送<code>HTTP Get</code>请求token：</p>
<ul>
<li><p>url：<code>https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=&#123;API_Key&#125;&amp;client_secret=&#123;Secret_Key&#125;</code></p>
</li>
<li><p>请求中携带参数API_key和Secret_key替换为你刚才申请的两个值，当然<code>&#123;&#125;</code>需要删除！</p>
</li>
<li><p>请求成功将获得一串<code>Json</code>，例如</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;refresh_token&quot;</span>: <span class="string">&quot;25.b55fe1d287227ca97aab219bb249b8ab.315360000.1798284651.282335-8574074&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;expires_in&quot;</span>: <span class="number">2592000</span>,</span><br><span class="line">  <span class="attr">&quot;scope&quot;</span>: <span class="string">&quot;public wise_adapt&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;session_key&quot;</span>: <span class="string">&quot;9mzdDZXu3dENdFZQurfg0Vz8slgSgvvOAUebNFzyzcpQ5EnbxbF+hfG9DQkpUVQdh4p6HbQcAiz5RmuBAja1JJGgIdJI&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;access_token&quot;</span>: <span class="string">&quot;24.6c5e1ff107f0e8bcef8c46d3424a0e78.2592000.1485516651.282335-8574074&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;session_secret&quot;</span>: <span class="string">&quot;dfac94a3489fe9fca7c3221cbf7525ff&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只需要获取<code>access_token</code>即可</p>
<p>若返回失败则会得到包含<code>error_description</code>的<code>Json</code>信息</p>
</li>
</ul>
<h3 id="调用所需接口"><a href="#调用所需接口" class="headerlink" title="调用所需接口"></a>调用所需接口</h3><p>文字识别分为通用文字识别、通用文字识别（高精度），不同的接口有不同的免费额度</p>
<p>通过发送<code>HTTP POST</code>上传图片数据或者地址进行文字识别</p>
<ul>
<li><p>url：<code>https://aip.baidubce.com/rest/2.0/ocr/v1/&#123;ocr_type&#125;?access_token=&#123;token&#125;</code></p>
<p>此处ocr_type根据不同的识别方式变化，可以用“general_basic”或者“accurate_basic”替换.</p>
<p>token是上一步获取的<code>access_token</code></p>
</li>
<li><p>post的请求体为表单类型，分为两种方式</p>
<ol>
<li><p>图片数据</p>
<p>图片数据必须使用Base64编码，并用以下格式作为请求体</p>
<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody><tr>
<td>image</td>
<td>base64数组</td>
</tr>
</tbody></table>
</li>
<li><p>图片地址</p>
<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody><tr>
<td>url</td>
<td>url字符串</td>
</tr>
</tbody></table>
<p>仅<code>general_basic</code>支持用网络图片</p>
</li>
</ol>
</li>
<li><p>请求完成后将返回 Json 数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;log_id&quot;</span>: <span class="number">2471272194</span>,</span><br><span class="line">    <span class="attr">&quot;words_result_num&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;words_result&quot;</span>: [</span><br><span class="line">        &#123;<span class="attr">&quot;words&quot;</span>: <span class="string">&quot; example&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">&quot;words&quot;</span>: <span class="string">&quot;helloworld&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>出错则会返回包含<code>err_msg</code>的 Json 数据，具体错误类型可见<a target="_blank" rel="noopener" href="https://ai.baidu.com/ai-doc/OCR/dkibizxnx">官方文档</a></p>
</li>
</ul>
<h3 id="Python使用例"><a href="#Python使用例" class="headerlink" title="Python使用例"></a>Python使用例</h3><p><a target="_blank" rel="noopener" href="https://github.com/838239178/tk-auto-study/blob/master/ocr.py">点此到Github中查看</a>上述介绍的内容分别对应<code>def _get_token()</code>和<code>def general_ocr(img_b64)</code></p>
<h3 id="额外选择"><a href="#额外选择" class="headerlink" title="额外选择"></a>额外选择</h3><p>百度ocr还包含很多种类型具体请查看 <a target="_blank" rel="noopener" href="https://ai.baidu.com/ai-doc/OCR/1k3h7y3db">官方文档</a>，调用api时也可传入其他参数，如是否检测图片方向、图片需要识别的语言等，这里就不多介绍，入门后看官方文档就没有任何问题了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2021/02/14/signUpBaiduOcr/" data-id="ckm77mrjb0009aghj7ozhf3lx" data-title="使用BaiduOcr识别图片文字" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-ai/" rel="tag">web ai</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-LinkGame" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/18/LinkGame/" class="article-date">
  <time class="dt-published" datetime="2020-12-17T16:00:00.000Z" itemprop="datePublished">2020-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/18/LinkGame/">LinkGame</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="《连连看》-Java课程设计方案"><a href="#《连连看》-Java课程设计方案" class="headerlink" title="《连连看》 Java课程设计方案"></a>《连连看》 Java课程设计方案</h1><blockquote>
<p>项目已开源，请点击：<a target="_blank" rel="noopener" href="https://github.com/838239178/linkgame">GithubHomePage</a></p>
</blockquote>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>目录<br>{:toc}</li>
</ul>
<h2 id="Swing界面组成"><a href="#Swing界面组成" class="headerlink" title="Swing界面组成"></a>Swing界面组成</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><h4 id="1-核心界面"><a href="#1-核心界面" class="headerlink" title="1.核心界面"></a>1.核心界面</h4><p>位于窗口中央，核心界面由n*n的方块组成，同种方块成对出现，并且是乱序的。每个方块一张图片，同类方块图片相同。方块间留足间隙满足观赏性。方块点击后应有方框标记。</p>
<h4 id="2-信息栏"><a href="#2-信息栏" class="headerlink" title="2.信息栏"></a>2.信息栏</h4><p>位于窗口上方，提示栏包括游戏的标题和游戏的具体信息，包括游戏剩余时间(s)，时间进度条(%)和得分情况。</p>
<p>得分：根据时间、重置次数、消去方块得出。其中消去方块分最多为<code>(n^4/2)</code>分，在此基础上除以<code>消耗时间/(n/4)*重置次数*(提示次数*5)*0.1</code>。</p>
<h4 id="3-菜单栏"><a href="#3-菜单栏" class="headerlink" title="3.菜单栏"></a>3.菜单栏</h4><p>位于窗口最上方横条，菜单栏应包含游戏暂停、游戏重开、游戏退出、方块再次打乱、提示方块和“关于”界面的选项，应使用菜单和子菜单组合。游戏退出后显示欢迎界面。</p>
<h4 id="4-关于界面"><a href="#4-关于界面" class="headerlink" title="4.关于界面"></a>4.关于界面</h4><p>新的对话框，由菜单栏启动，内容应包含该项目的基本信息，包括作者、时间、项目名称、源码地址等。</p>
<h4 id="5-欢迎界面"><a href="#5-欢迎界面" class="headerlink" title="5.欢迎界面"></a>5.欢迎界面</h4><p>可切换的界面，用于打开主界面。界面中应包括游戏标题、开始按钮、关于按钮和退出按钮。开始按钮点击后应显示难度选择按钮。</p>
<h4 id="6-结算界面"><a href="#6-结算界面" class="headerlink" title="6.结算界面"></a>6.结算界面</h4><p>可切换的界面，显示得分和总消耗时间。包括退出、重开按钮。退出后显示欢迎界面。</p>
<h4 id="界面结构图"><a href="#界面结构图" class="headerlink" title="界面结构图"></a>界面结构图</h4><div align=center><img src="http://assets.processon.com/chart_image/5fbe6589079129461564cb97.png" alt="界面结构" style="zoom:50%;" />


<h3 id="类的封装"><a href="#类的封装" class="headerlink" title="类的封装"></a>类的封装</h3><h4 id="GameClient"><a href="#GameClient" class="headerlink" title="GameClient"></a>GameClient</h4><p><em>extends JFrame</em></p>
<p>界面程序的本体，用于联络各个组件，控制游戏开始结束。</p>
<p><strong>功能：</strong></p>
<ul>
<li>创建菜单栏、信息栏、游戏界面、关于界面、欢迎界面、结算界面。</li>
<li>订阅组件的监听器，实现各种页面的切换。页面切换使用CardLayout实现。</li>
<li>开始游戏和重开游戏，设定各个组件的初始参数。</li>
</ul>
<h4 id="EntryPanel"><a href="#EntryPanel" class="headerlink" title="EntryPanel"></a>EntryPanel</h4><p><em>extends JPanel</em></p>
<p>退出或者开始。记录选择的难度（地图规模、方块类数）。</p>
<p><strong>功能：</strong></p>
<ul>
<li>提供获取所选难度的方法</li>
<li>切换界面&gt;(GamePanel+MessagePanel)</li>
</ul>
<h4 id="OverPanel"><a href="#OverPanel" class="headerlink" title="OverPanel"></a>OverPanel</h4><p><em>extends JPanel</em></p>
<p>结算界面，显示成功或者失败信息。</p>
<p><strong>功能：</strong></p>
<ul>
<li><p>重开游戏&gt;GameClient(reopen)</p>
</li>
<li><p>切换界面&gt;EntryPanel</p>
</li>
<li><p>获取从MessagePanel中获取游戏信息</p>
</li>
</ul>
<h4 id="MessagePanel"><a href="#MessagePanel" class="headerlink" title="MessagePanel"></a>MessagePanel</h4><p><em>extends JPanel</em></p>
<p>显示信息栏界面的内容。主要用于记录分数和时间。</p>
<p><strong>功能：</strong></p>
<ul>
<li>各种参数的getter/setter方法。</li>
<li>当<u>时间耗尽</u>时调用自定义监听器</li>
</ul>
<h4 id="GamePanel"><a href="#GamePanel" class="headerlink" title="GamePanel"></a>GamePanel</h4><p><em>extends JPanel</em></p>
<p>使用Block对象填充GridLayout。根据GameMap对象提供的数据绘制Block，方块相消判定成功后绘制连线，记录数量。</p>
<p><strong>功能：</strong></p>
<ul>
<li>为每一个Block添加MouseClicked监听器：被点击时传递自身的引用给GamePanel。</li>
<li>使用GameMap判断两个坐标是否能连通后，若成功则<u>画线</u>并检测是否消除完全，失败则改变所选取的Block状态，并删除其引用。</li>
<li>画线：<ol>
<li>直接连通：直接使用两方块坐标画线</li>
<li>单拐点：两方块坐标以及一个拐点，用三个点画线段。</li>
<li>双拐点：两方块坐标以及两个拐点，用四个点画线段，应注意线段总是在X或Y轴方向上。</li>
</ol>
</li>
<li>刷新GameMap后，遍历Blocks，重置Blocks状态</li>
<li>提示两个可以相消的方块。</li>
<li>当<u>消除一次方块</u>后调用自定义监听器。</li>
</ul>
<h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4><p><em>extends JComponent</em></p>
<p>保存方块在Map上的下标。</p>
<p><strong>功能：</strong></p>
<ul>
<li>重置方块，包括图片、ID、状态（利用BlockFactory）</li>
<li>被选取时，绘制方框</li>
<li>id的getter</li>
</ul>
<h4 id="BlockFactory"><a href="#BlockFactory" class="headerlink" title="BlockFactory"></a>BlockFactory</h4><p>单例工厂类，用enum类型。</p>
<p><strong>功能：</strong></p>
<ul>
<li>通过方块的id，生成一个带图片的Block对象。</li>
<li>通过方块id，重置一个现成的Block对象。</li>
</ul>
<h4 id="Sound"><a href="#Sound" class="headerlink" title="Sound"></a>Sound</h4><p>音效对象，实现多线程播放音效。</p>
<h4 id="AboutDialog"><a href="#AboutDialog" class="headerlink" title="AboutDialog"></a>AboutDialog</h4><p><em>extends JDialog</em></p>
<p>显示关于该游戏以及该项目的信息。</p>
<h4 id="ScaleIcon"><a href="#ScaleIcon" class="headerlink" title="ScaleIcon"></a>ScaleIcon</h4><p><em>implements Icon</em></p>
<p>实现图片随容器大小变化而变化</p>
<h4 id="UMP类图"><a href="#UMP类图" class="headerlink" title="UMP类图"></a>UMP类图</h4><p><img src="http://assets.processon.com/chart_image/5fe47efae401fd549c80026b.png" alt="类图1"></p>
<h2 id="游戏逻辑构建"><a href="#游戏逻辑构建" class="headerlink" title="游戏逻辑构建"></a>游戏逻辑构建</h2><p>游戏逻辑主要在于方块数据处理和判断两个方块是否能消去。</p>
<h3 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h3><p>假设地图规模大小为<code>n*n</code>，方块种类为<code>i</code>种</p>
<h4 id="1-记录方块分布数据"><a href="#1-记录方块分布数据" class="headerlink" title="1.记录方块分布数据"></a>1.记录方块分布数据</h4><p>一个二维数组，不同的ID对应不同的方块，同一个ID应成对出现。空白方块使用特殊标记。</p>
<h4 id="2-操作方块分布数据"><a href="#2-操作方块分布数据" class="headerlink" title="2.操作方块分布数据"></a>2.操作方块分布数据</h4><p>重新打乱二维数组中的数据，应注意只能打乱非空白方块的数据，空白的位置应保持不变。</p>
<p>判断两个方块是否能够相消，以何种方式相消。</p>
<p>遍历查找两个可连通的点。</p>
<p>传出和修改对应点的方块ID。</p>
<h4 id="3-生成方块分布数据"><a href="#3-生成方块分布数据" class="headerlink" title="3.生成方块分布数据"></a>3.生成方块分布数据</h4><p>根据地图大小，创建一个二维数组，并在里面随机添加方块的ID。每种类型的方块添加<code>(n*n)/i</code>个，共<code>(n*n)/2i</code>组。根据需求<code>i == n</code></p>
<h3 id="核心算法"><a href="#核心算法" class="headerlink" title="核心算法"></a>核心算法</h3><p>按照连连看规则——可连接的两个方块之间最多用三条直线相连——可以分类为三种判定方式。在判定过程中应注意边界问题。</p>
<h4 id="1-直接连通"><a href="#1-直接连通" class="headerlink" title="1.直接连通"></a>1.直接连通</h4><p>即两个方块间可以用一条直线连接。处在同一行或者同一列且中间没有其他方块。</p>
<h4 id="2-单拐点连通"><a href="#2-单拐点连通" class="headerlink" title="2.单拐点连通"></a>2.单拐点连通</h4><p>即两个方块间可以用两条线段连接。以两个方块为顶点得到一个矩形，矩形的另外两个顶点中，任意一个可以<strong>空白顶点</strong>，与这两个方块都可以<strong>直接连通</strong>，则可连接。</p>
<h4 id="3-双拐点连通"><a href="#3-双拐点连通" class="headerlink" title="3.双拐点连通"></a>3.双拐点连通</h4><p>即两个方块间可以用三条线段连接。搜索其中一个方块周围四个方向空白的点，若任意一个可以<strong>直接连通</strong>点，能与另一个方块单拐点连通，则能够连通。</p>
<h4 id="4-寻找连通点"><a href="#4-寻找连通点" class="headerlink" title="4.寻找连通点"></a>4.寻找连通点</h4><h5 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h5><p><em>暴力求解，<strong>不推荐</strong></em></p>
<p>四重循环，遍历每一个方块，起点遍历一次，终点遍历一次，判断起点和终点的连通性。</p>
<h5 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h5><p><em>广搜</em></p>
<p>对每个方块进行广搜判断，两种判断方法</p>
<ol>
<li>方向改变不大于三次内可以找到的终点即可以连通，连通类型根据方向改变次数可以得出，拐点和方向改变次数每一次搜索都需要记录。<em>（稍微麻烦，但速度快一点）</em></li>
<li>对找到的终点进行连通性判断，不需要额外记录。<em>（简单，相对慢一点，<strong>推荐</strong>）</em></li>
</ol>
<h4 id="5-数据随机"><a href="#5-数据随机" class="headerlink" title="5.数据随机"></a>5.数据随机</h4><p>将所有决定好的方块ID放入一个容器中进行混排，每次随机从容器中抛出一个ID设置在Map上，<strong>容器内的ID不能重复抛出</strong>。</p>
<h4 id="判断流程图"><a href="#判断流程图" class="headerlink" title="判断流程图"></a>判断流程图</h4><div align=left><img src="http://assets.processon.com/chart_image/5fb9fe8b6376895bf97aa12a.png" alt="判断顺序" style="zoom:65%;" />



<h4 id="连通示意图"><a href="#连通示意图" class="headerlink" title="连通示意图"></a>连通示意图</h4><div align=center><img src="https://i.loli.net/2020/11/22/mxpfO8b29MYSCET.png" alt="判断顺序" style="zoom:80%;" />

<h3 id="类的封装-1"><a href="#类的封装-1" class="headerlink" title="类的封装"></a>类的封装</h3><h4 id="LinkType"><a href="#LinkType" class="headerlink" title="LinkType"></a>LinkType</h4><p>枚举类型，表示四种方块的连通方式（包括一种无法连通）。</p>
<ul>
<li>STRAIGHT_LINK</li>
<li>SINGLECORNER_LINK</li>
<li>DOUBLECORNER_LINK</li>
<li>NO_LINK</li>
</ul>
<h4 id="GameMap"><a href="#GameMap" class="headerlink" title="GameMap"></a>GameMap</h4><p>保存方块数据的类。负责判断连通，提供数据和信号给界面程序。构造时应指定地图大小和方块ID最大值。</p>
<p>接口：</p>
<ul>
<li>判断是否连通的方法，并记录所有拐点，返回<u>LinkResult</u>。</li>
<li>地图数据的getter方法，返回方块ID。</li>
<li>清空指定两个点的方法。</li>
<li>判断并清空两个点的方法，返回布尔类型。</li>
<li>重新随机地图的方法。</li>
<li>自动寻找两个可相消的点。成功返回一个<u>LinkResult</u>，失败抛出RuntimException（或自定义一个Exception）。</li>
</ul>
<h4 id="LinkResult"><a href="#LinkResult" class="headerlink" title="LinkResult"></a>LinkResult</h4><p>自定义封装类，用于返回五个参数（初始化为null），为每个参数设置一个getter/setter。</p>
<ul>
<li>fristPoint</li>
<li>secondPoint</li>
<li>firstCorner</li>
<li>secondCorner</li>
<li>linkType</li>
</ul>
<h4 id="UMP类图-1"><a href="#UMP类图-1" class="headerlink" title="UMP类图"></a>UMP类图</h4><p><img src="http://assets.processon.com/chart_image/5fed810ff346fb432bcf475a.png" alt="类图2"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2020/12/18/LinkGame/" data-id="ckm77mrj90005aghj3cmn5rfl" data-title="LinkGame" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-swing/" rel="tag">java swing</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JavaSimpleCalculator" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/18/JavaSimpleCalculator/" class="article-date">
  <time class="dt-published" datetime="2020-11-17T16:00:00.000Z" itemprop="datePublished">2020-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/18/JavaSimpleCalculator/">Java Simple Calculator</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="简易计算器"><a href="#简易计算器" class="headerlink" title="简易计算器"></a>简易计算器</h1><h2 id="程序解释"><a href="#程序解释" class="headerlink" title="程序解释"></a>程序解释</h2><h3 id="原理详解"><a href="#原理详解" class="headerlink" title="原理详解"></a>原理详解</h3><p>从类的设计的角度上来讲，计算器应该是界面与操作分离，由界面程序获取操作数并传递给计算程序，从计算程序中获取结果。</p>
<h3 id="类的设计"><a href="#类的设计" class="headerlink" title="类的设计"></a>类的设计</h3><ol>
<li><p>Calculator</p>
<p>用于计算的类，传入操作数和操作符后可获取结果，运算错误抛出异常。</p>
</li>
<li><p>Calculator Frame</p>
<p>计算器的界面类，提供操作数和操作符。</p>
</li>
</ol>
<h2 id="结构解析"><a href="#结构解析" class="headerlink" title="结构解析"></a>结构解析</h2><p>Calculator类采用两个堆栈分别存放运算数和操作符，在计算时从中抛出操作数与操作符。对小数和负数，采用标记位进行判断。</p>
<p>小数：当输入了小数点“.“后，记录接下来输入数字的个数，在数字输入结束后（即输入操作符）时，将栈中的第一位数抛出并转化为小数</p>
<p>负数：当输入了”neg”标记后，同上，在同一时刻转化成负数</p>
<p>输入数字或者操作符后，自动检查堆栈元素进行计算，因此这个简易计算器在按下“=”前，在特定情况下，会先计算部分算式；</p>
<p><del><em>另一种思路：输入的任何符号都先记录起来等按下“=”时再进行读取数字和操作符进行运算</em></del></p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>因为即时运算的原因，计算器无法实现单步删除功能，只能直接清空重置计算器。代码可拓展性差，添加新的操作符运算可能需要改动部分原有逻辑。</p>
<p><del>要不要改？卧槽，我懒啊！</del></p>
<h3 id="源码展示"><a href="#源码展示" class="headerlink" title="源码展示"></a>源码展示</h3><h6 id="Calculator-java"><a href="#Calculator-java" class="headerlink" title="Calculator.java"></a>Calculator.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.ws.api.ha.StickyFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, Integer&gt; operatorPriority;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedList&lt;Double&gt; numberStack;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedList&lt;String&gt; operatorStack;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否开始输入下一个数字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> nextNum;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否已经完成了一次计算</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> calculated;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否输入了小数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> decimal;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> decimalDigits;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否输入了负数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> negative;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Calculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        operatorPriority = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        numberStack = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        operatorStack = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; level1 = Arrays.asList(<span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        List&lt;String&gt; level2 = Arrays.asList(<span class="string">&quot;*&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        level1.forEach(op -&gt; operatorPriority.put(op, <span class="number">1</span>));</span><br><span class="line">        level2.forEach(op -&gt; operatorPriority.put(op, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        reset();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        calculated = <span class="keyword">true</span>;</span><br><span class="line">        numberStack.clear();</span><br><span class="line">        operatorStack.clear();</span><br><span class="line">        numberStack.push(<span class="number">0.0</span>);</span><br><span class="line">        nextNum = <span class="keyword">true</span>;</span><br><span class="line">        negative = <span class="keyword">false</span>;</span><br><span class="line">        decimal = <span class="keyword">false</span>;</span><br><span class="line">        decimalDigits = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否已经完成了一次计算</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCalculated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.calculated;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得计算结果</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 计算结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ArithmeticException 如果输入不合法运算公式则抛出这个异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">()</span> <span class="keyword">throws</span> ArithmeticException </span>&#123;</span><br><span class="line">        tryDecimal();</span><br><span class="line">        tryNegative();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!numberStack.isEmpty() &amp;&amp; !operatorStack.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">double</span> num2 = numberStack.pop();</span><br><span class="line">            <span class="keyword">double</span> num1 = numberStack.pop();</span><br><span class="line">            String operator = operatorStack.pop();</span><br><span class="line">            numberStack.push(calculate(num1, num2, operator));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        calculated = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (numberStack.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> numberStack.peek();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输入一个操作数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 整数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inputNum</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> number = value;</span><br><span class="line">        <span class="keyword">if</span> (!nextNum) &#123;</span><br><span class="line">            number = numberStack.pop();</span><br><span class="line">            number = number * <span class="number">10</span> + value;</span><br><span class="line">            <span class="keyword">if</span> (decimal) decimalDigits++;</span><br><span class="line">        &#125;</span><br><span class="line">        numberStack.push(number);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开始输入当前这个数字</span></span><br><span class="line">        nextNum = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//还未完成一次计算</span></span><br><span class="line">        calculated = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输入一个运算符号</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> op 运算符号，目前仅支持“+、-、*、/“，支持小数和负数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ArithmeticException 如果输入不合法运算公式则抛出这个异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inputOperator</span><span class="params">(String op)</span> <span class="keyword">throws</span> ArithmeticException </span>&#123;</span><br><span class="line">        <span class="comment">//输入运算符时意味着正在进行运算（即未完成）</span></span><br><span class="line">        calculated = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (op.equals(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">            decimal = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(op.equals(<span class="string">&quot;neg&quot;</span>))&#123;</span><br><span class="line">            negative = !negative;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tryDecimal();</span><br><span class="line">        tryNegative();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!operatorStack.isEmpty() &amp;&amp; compareOperator(op, operatorStack.peek()) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            Double num2 = numberStack.pop();</span><br><span class="line">            Double num1 = numberStack.pop();</span><br><span class="line">            String operator = operatorStack.pop();</span><br><span class="line">            numberStack.push(calculate(num1, num2, operator));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        operatorStack.push(op);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输运算符后意味着开始输入下一个数字</span></span><br><span class="line">        nextNum = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检验是否输入了小数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">tryDecimal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果刚刚输入的数字（即栈顶）是小数</span></span><br><span class="line">        <span class="keyword">if</span> (decimal) &#123;</span><br><span class="line">            <span class="keyword">double</span> top = numberStack.pop();</span><br><span class="line">            top *= Math.pow(<span class="number">10</span>, -<span class="number">1</span> * decimalDigits);</span><br><span class="line">            numberStack.push(top);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//下一个数字不一定是小数，重置小数参数</span></span><br><span class="line">            decimal = <span class="keyword">false</span>;</span><br><span class="line">            decimalDigits = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">tryNegative</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(negative)&#123;</span><br><span class="line">            <span class="keyword">double</span> top = numberStack.pop();</span><br><span class="line">            numberStack.push(-top);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//重置标记</span></span><br><span class="line">            negative = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">double</span> num1, <span class="keyword">double</span> num2, String op)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用string类型消除double精度误差</span></span><br><span class="line">        BigDecimal bigNum1 = <span class="keyword">new</span> BigDecimal(String.valueOf(num1));</span><br><span class="line">        BigDecimal bigNum2 = <span class="keyword">new</span> BigDecimal(String.valueOf(num2));</span><br><span class="line">        BigDecimal result;</span><br><span class="line">        <span class="keyword">switch</span> (op) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">                result = bigNum1.add(bigNum2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">                result = bigNum1.subtract(bigNum2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">                result = bigNum1.multiply(bigNum2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">                result = bigNum1.divide(bigNum2, BigDecimal.ROUND_HALF_UP);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArithmeticException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result.doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">compareOperator</span><span class="params">(String op1, String op2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> op1Level = <span class="number">0</span>, op2Level = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        op1Level = operatorPriority.get(op1);</span><br><span class="line">        op2Level = operatorPriority.get(op2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> op1Level - op2Level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="CalculatorFrame-java"><a href="#CalculatorFrame-java" class="headerlink" title="CalculatorFrame.java"></a>CalculatorFrame.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> calculator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorFrame</span> <span class="keyword">extends</span> <span class="title">JFrame</span> </span>&#123;</span><br><span class="line">    <span class="comment">//region -JComponents-</span></span><br><span class="line">    <span class="keyword">private</span> JPanel northPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel centerPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel numberPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel operatorPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel southPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel westPanel;</span><br><span class="line">    <span class="keyword">private</span> JPanel eastPanel;</span><br><span class="line">    <span class="keyword">private</span> JTextField textArea;</span><br><span class="line">    <span class="keyword">private</span> JButton[] numberBtn;</span><br><span class="line">    <span class="keyword">private</span> JButton[] operatorBtn;</span><br><span class="line">    <span class="keyword">private</span> JButton point;</span><br><span class="line">    <span class="keyword">private</span> JButton delete;</span><br><span class="line">    <span class="keyword">private</span> JButton neg;</span><br><span class="line">    <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Calculator calculator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setLayout(<span class="keyword">new</span> BorderLayout(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">        centerPanel = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> BorderLayout(<span class="number">10</span>, <span class="number">6</span>));</span><br><span class="line">        numberPanel = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> GridLayout(<span class="number">4</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">        operatorPanel = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> GridLayout(<span class="number">6</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>));</span><br><span class="line"></span><br><span class="line">        northPanel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        southPanel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        eastPanel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        westPanel = <span class="keyword">new</span> JPanel();</span><br><span class="line"></span><br><span class="line">        textArea = <span class="keyword">new</span> JTextField(<span class="string">&quot;0&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        numberBtn = <span class="keyword">new</span> JButton[<span class="number">10</span>];</span><br><span class="line">        operatorBtn = <span class="keyword">new</span> JButton[<span class="number">5</span>];</span><br><span class="line">        delete = <span class="keyword">new</span> JButton(<span class="string">&quot;AC&quot;</span>);</span><br><span class="line">        point = <span class="keyword">new</span> JButton(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        neg = <span class="keyword">new</span> JButton(<span class="string">&quot;neg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        textArea.setEditable(<span class="keyword">false</span>);</span><br><span class="line">        textArea.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;微软雅黑&quot;</span>, Font.BOLD, <span class="number">24</span>));</span><br><span class="line">        textArea.setHorizontalAlignment(SwingConstants.TRAILING);</span><br><span class="line"></span><br><span class="line">        point.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;黑体&quot;</span>, Font.BOLD, <span class="number">18</span>));</span><br><span class="line">        delete.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;黑体&quot;</span>, Font.BOLD, <span class="number">15</span>));</span><br><span class="line"></span><br><span class="line">        delete.addActionListener(event -&gt; &#123;</span><br><span class="line">            textArea.setText(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            calculator.reset();</span><br><span class="line">        &#125;);</span><br><span class="line">        point.addActionListener(<span class="keyword">new</span> OperatorButtonListener(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        neg.addActionListener(<span class="keyword">new</span> OperatorButtonListener(<span class="string">&quot;neg&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            numberBtn[i] = <span class="keyword">new</span> JButton(String.valueOf(i));</span><br><span class="line">            numberBtn[i].addActionListener(<span class="keyword">new</span> NumberButtonListener(i));</span><br><span class="line">            numberBtn[i].setFont(<span class="keyword">new</span> Font(<span class="string">&quot;黑体&quot;</span>, Font.BOLD, <span class="number">18</span>));</span><br><span class="line">            numberPanel.add(numberBtn[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        numberPanel.add(point);</span><br><span class="line">        numberPanel.add(delete);</span><br><span class="line"></span><br><span class="line">        operatorPanel.add(neg);</span><br><span class="line"></span><br><span class="line">        String[] temp = &#123;<span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;=&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; operatorBtn.length; i++) &#123;</span><br><span class="line">            operatorBtn[i] = <span class="keyword">new</span> JButton(temp[i]);</span><br><span class="line">            operatorBtn[i].setFont(<span class="keyword">new</span> Font(<span class="string">&quot;黑体&quot;</span>, Font.BOLD, <span class="number">18</span>));</span><br><span class="line">            operatorBtn[i].addActionListener(<span class="keyword">new</span> OperatorButtonListener(temp[i]));</span><br><span class="line">            operatorPanel.add(operatorBtn[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        centerPanel.add(BorderLayout.NORTH, textArea);</span><br><span class="line">        centerPanel.add(BorderLayout.CENTER, numberPanel);</span><br><span class="line">        centerPanel.add(BorderLayout.EAST, operatorPanel);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.add(BorderLayout.NORTH, northPanel);</span><br><span class="line">        <span class="keyword">this</span>.add(BorderLayout.CENTER, centerPanel);</span><br><span class="line">        <span class="keyword">this</span>.add(BorderLayout.SOUTH, southPanel);</span><br><span class="line">        <span class="keyword">this</span>.add(BorderLayout.EAST, eastPanel);</span><br><span class="line">        <span class="keyword">this</span>.add(BorderLayout.WEST, westPanel);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.pack();</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CalculatorFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        initComponent();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">&quot;简易计算器&quot;</span>);</span><br><span class="line"></span><br><span class="line">        calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">NumberButtonListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NumberButtonListener</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (calculator.isCalculated()) &#123;</span><br><span class="line">                calculator.reset();</span><br><span class="line">                textArea.setText(String.valueOf(value));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                textArea.setText(textArea.getText() + value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            calculator.inputNum(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">OperatorButtonListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">OperatorButtonListener</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (value.equals(<span class="string">&quot;=&quot;</span>)) &#123;</span><br><span class="line">                    textArea.setText(String.valueOf(calculator.getResult()));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (value.equals(<span class="string">&quot;neg&quot;</span>) &amp;&amp; calculator.isCalculated()) &#123;</span><br><span class="line">                        textArea.setText(“neg”);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        textArea.setText(textArea.getText() + value);</span><br><span class="line">                    &#125;</span><br><span class="line">                    calculator.inputOperator(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ArithmeticException arithmeticException) &#123;</span><br><span class="line">                calculator.reset();</span><br><span class="line">                textArea.setText(<span class="string">&quot;Error Input&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> CalculatorFrame();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2020/11/18/JavaSimpleCalculator/" data-id="ckm77mrj80004aghjf4pmfwnu" data-title="Java Simple Calculator" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-swing/" rel="tag">java swing</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cityRescue" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/18/cityRescue/" class="article-date">
  <time class="dt-published" datetime="2020-05-17T16:00:00.000Z" itemprop="datePublished">2020-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/18/cityRescue/">城市间紧急救援</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目要求"><a href="#题目要求" class="headerlink" title="题目要求"></a>题目要求</h2><p>作为一个城市的应急救援队伍的负责人，你有一张特殊的全国地图。在地图上显示有多个分散的城市和一些连接城市的快速道路。每个城市的救援队数量和每一条连接两个城市的快速道路长度都标在地图上。<br>当其他城市有紧急求助电话给你的时候，你的任务是带领你的救援队尽快赶往事发地，同时，一路上召集尽可能多的救援队。</p>
<h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h4><p>输入第一行给出4个正整数N、M、S、D，其中N（2≤N≤500）是城市的个数，顺便假设城市的编号为0 ~ (N−1)；M是快速道路的条数；S是出发地的城市编号；D是目的地的城市编号。<br>第二行给出N个正整数，其中第i个数是第i个城市的救援队的数目，数字间以空格分隔。随后的M行中，每行给出一条快速道路的信息，分别是：城市1、城市2、快速道路的长度，中间用空格分开，数字均为整数且不超过500。输入保证救援可行且最优解唯一。</p>
<h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式:"></a>输出格式:</h4><p>第一行输出最短路径的条数和能够召集的最多的救援队数量。第二行输出从S到D的路径中经过的城市编号。数字间以空格分隔，输出结尾不能有多余空格。</p>
<h4 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例:"></a>输入样例:</h4><p>4 5 0 3</p>
<p>20 30 40 10</p>
<p>0 1 1</p>
<p>1 3 2</p>
<p>0 3 3</p>
<p>0 2 2</p>
<p>2 3 2</p>
<h4 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例:"></a>输出样例:</h4><p>2 60</p>
<p>0 1 3</p>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>利用Dijsktra算法进行变式，因为题目要求的权值有两种，且长度优先级大于救援人数，因此自定义一个类/结构体来表示dist[]，并按照需求重载操作符。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">int</span> dis;</span><br><span class="line">	<span class="keyword">int</span> manNum;</span><br><span class="line">	node(<span class="keyword">int</span> a = INF, <span class="keyword">int</span> b = <span class="number">0</span>):dis(a),manNum(b)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node &amp; a) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dis == a.dis)</span><br><span class="line">			<span class="keyword">return</span> manNum &gt; a.manNum;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> dis &lt; a.dis;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &gt; (<span class="keyword">const</span> node&amp; a) &#123;</span><br><span class="line">		<span class="keyword">return</span> !(*<span class="keyword">this</span> &lt; a);</span><br><span class="line">	&#125;</span><br><span class="line">	node <span class="keyword">operator</span> + (<span class="keyword">const</span> node&amp; a) &#123;</span><br><span class="line">		<span class="keyword">return</span> node&#123; dis + a.dis, manNum + a.manNum &#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>本题重点是<strong>最短路径条数</strong>，要想到如 a-&gt;b-&gt;c , a-&gt;c的条数等于a-&gt;b的条数加上b-&gt;c的条数这个递推思想，具体实现方法就是数组再每次遍历邻接点的时候进行判断。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//entry 入口</span></span><br><span class="line"><span class="comment">//pathchoice entry-&gt;每个点的最短路径条数</span></span><br><span class="line">pathchoice[entry] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//访问v的每一个邻接点w</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> w = <span class="number">0</span>; w &lt; n; w++) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!visted[w] &amp;&amp; mg[v][w] != INF) &#123;</span><br><span class="line">		node temp = node&#123; mg[v][w],rescue[w] &#125;;				</span><br><span class="line">		<span class="keyword">if</span> (dist[w].dis == temp.dis + dist[v].dis)            <span class="comment">//1.如果entry-&gt;w的最短距离和entry-&gt;v-&gt;w的距离相等，则entry-&gt;w的条数就要进行递推</span></span><br><span class="line">			pathchoice[w] += pathchoice[v];</span><br><span class="line">		<span class="keyword">if</span> (dist[w] &gt; dist[v] + temp) &#123;</span><br><span class="line">			dist[w] = dist[v] + temp;</span><br><span class="line">			path[w] = v;</span><br><span class="line">			pathchoice[w] = max(pathchoice[w],pathchoice[v]);      <span class="comment">//2.真正要保留的是最短路径的条数</span></span><br><span class="line">		&#125;				</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里要解释一下为什么1，2两点是分开且顺序不能颠倒。因为最短路径条数不同于最优路径，最短路径不需要考虑救援人数，如果颠倒了顺序就可能会导致最短路径条数因为最优路径的关系先一步发生变化。<br>然后<strong>2</strong>的地方用了一个<code>max()</code>，是因为即使满足<strong>1</strong>也有可能进入这个if(详见claass node中重载的运算符), 本来pathchoice[w] = pathchoice[v] 应该是第一次遍历到做的赋值，但是可能在前几次遍历中已经经过了<strong>1</strong>，<br>所以应该保留最大的哪个数才是最短路径的条数。</p>
<p><em>AC代码参考:</em> <a target="_blank" rel="noopener" href="https://github.com/838239178/just-Quiz/blob/master/%E5%9B%BE-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84-%E5%9F%8E%E5%B8%82%E9%97%B4%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4">github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.pressed.top/2020/05/18/cityRescue/" data-id="ckm77mrj80003aghjaa0ieyfa" data-title="城市间紧急救援" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm-c-c/" rel="tag">algorithm c/c++</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm-c-c/" rel="tag">algorithm c/c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos-tiledmap/" rel="tag">cocos tiledmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-swing/" rel="tag">java swing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-web/" rel="tag">java web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-ai/" rel="tag">web ai</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm-c-c/" style="font-size: 15px;">algorithm c/c++</a> <a href="/tags/cocos-tiledmap/" style="font-size: 10px;">cocos tiledmap</a> <a href="/tags/java-swing/" style="font-size: 15px;">java swing</a> <a href="/tags/java-web/" style="font-size: 20px;">java web</a> <a href="/tags/web-ai/" style="font-size: 10px;">web ai</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/12/myBatis/">MyBatis</a>
          </li>
        
          <li>
            <a href="/2021/03/12/javaweb/">Java Web</a>
          </li>
        
          <li>
            <a href="/2021/02/21/springTxError/">关于Spring事务管理失效问题</a>
          </li>
        
          <li>
            <a href="/2021/02/14/signUpBaiduOcr/">使用BaiduOcr识别图片文字</a>
          </li>
        
          <li>
            <a href="/2020/12/18/LinkGame/">LinkGame</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 ShiJh<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>